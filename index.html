<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora Interna Presupuesto Edici√≥n Video</title>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 2rem;
    background: #f9fafb;
    color: #111827;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  h1, h2 {
    color: #1f2937;
    text-align: center;
  }
  form {
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 8px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
    margin-bottom: 2rem;
  }
  label {
    font-weight: 600;
    display: block;
    margin-top: 1rem;
    margin-bottom: 0.3rem;
    color: #374151;
  }
  input[type="text"], input[type="number"], input[type="date"], select, textarea {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    border-radius: 5px;
    font-size: 1rem;
    color: #111827;
    resize: vertical;
  }
  textarea {
    min-height: 60px;
  }
  input[type="checkbox"] {
    margin-right: 0.5rem;
  }
  button {
    background-color: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.7rem 1.4rem;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 1.5rem;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #1d4ed8;
  }
  #resultado, #error {
    background: #e0f2fe;
    border-left: 4px solid #0284c7;
    padding: 1rem;
    margin-top: 1.5rem;
    border-radius: 6px;
    font-weight: 600;
  }
  #error {
    background: #fee2e2;
    border-left-color: #dc2626;
    font-weight: 700;
    color: #991b1b;
  }
  #historialContainer {
    margin-top: 2rem;
    background: white;
    border-radius: 8px;
    padding: 1rem 1.5rem;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  th, td {
    border: 1px solid #d1d5db;
    padding: 0.5rem 0.7rem;
    text-align: center;
    font-size: 0.9rem;
  }
  th {
    background: #e5e7eb;
  }
  #historialContainer table {
    max-height: 300px;
    overflow-y: auto;
    display: block;
  }
  #logoPlaceholder {
    width: 120px;
    height: 50px;
    background: #ddd;
    display: block;
    margin-bottom: 1rem;
    text-align: center;
    line-height: 50px;
    color: #888;
    font-weight: bold;
    user-select: none;
  }
</style>

</head>
<body>

<h1>üõ†Ô∏è Calculadora Interna de Presupuesto de Edici√≥n de Video</h1>
<p style="text-align:center; max-width:700px; margin:auto; margin-bottom:2rem; color:#6b7280;">
Completa los datos para estimar horas y precio justo. Gener√° PDF para cliente con info resumida y tu logo.
</p>

<form id="presupuestoForm" autocomplete="off">

  <fieldset>
    <legend><strong>1. Contexto General del Proyecto</strong></legend>
    <label for="objetivo">Objetivo del video</label>
    <select id="objetivo" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="Promocional">Promocional</option>
      <option value="Educativo">Educativo</option>
      <option value="Redes sociales">Redes sociales</option>
      <option value="Interno">Interno</option>
      <option value="Otro">Otro</option>
    </select>

    <label for="publicacion">Lugar de publicaci√≥n o distribuci√≥n</label>
    <input type="text" id="publicacion" placeholder="Ej: YouTube, Instagram..." required>

    <label for="publico">P√∫blico objetivo</label>
    <input type="text" id="publico" placeholder="Ej: J√≥venes, profesionales..." required>

    <label for="referenciaEstilo">Referencia de estilo (URL o descripci√≥n)</label>
    <textarea id="referenciaEstilo" placeholder="Ej: videos din√°micos, minimalistas..."></textarea>
  </fieldset>

  <fieldset>
    <legend><strong>2. Material Entregado</strong></legend>
    <label>¬øMaterial entregado o grabaci√≥n necesaria?</label>
    <select id="materialGrabado" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="Solo material grabado">Solo material grabado</option>
      <option value="Necesito que graben">Necesito que graben</option>
    </select>

    <label for="formatoMaterial">Formato del material</label>
    <input type="text" id="formatoMaterial" placeholder="Ej: MP4, MOV..." required>

    <label for="resolucionMaterial">Resoluci√≥n y duraci√≥n aproximada</label>
    <input type="text" id="resolucionMaterial" placeholder="Ej: 1080p, 2 horas..." required>

    <label>Organizaci√≥n del material</label>
    <select id="organizacionMaterial" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="Todo organizado">Todo organizado</option>
      <option value="Hay que limpiar y seleccionar">Hay que limpiar y seleccionar</option>
    </select>
  </fieldset>

  <fieldset>
    <legend><strong>3. Tipo de Edici√≥n</strong></legend>
    <label for="tipoEdicion">Tipo de edici√≥n</label>
    <select id="tipoEdicion" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="R√°pida para redes">R√°pida para redes</option>
      <option value="Documental">Documental</option>
      <option value="Corporativa">Corporativa</option>
      <option value="Emocional">Emocional</option>
      <option value="Cinematogr√°fica">Cinematogr√°fica</option>
      <option value="Otro">Otro</option>
    </select>

    <label>Efectos, transiciones, motion graphics o animaci√≥n</label>
    <select id="efectos" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="Efectos simples">Efectos simples</option>
      <option value="Motion graphics/animaci√≥n avanzada">Motion graphics/animaci√≥n avanzada</option>
    </select>

    <label>Edici√≥n multic√°mara</label>
    <select id="multicamara" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="S√≠">S√≠</option>
    </select>
  </fieldset>

  <fieldset>
    <legend><strong>4. Elementos Extra</strong></legend>
    <label>Subt√≠tulos</label>
    <select id="subtitulos" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="Autom√°ticos">Autom√°ticos</option>
      <option value="Personalizados">Personalizados</option>
    </select>

    <label>M√∫sica</label>
    <select id="musica" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="Proporcionada por cliente">Proporcionada por cliente</option>
      <option value="Buscar/licenciar">Buscar/licenciar</option>
    </select>

    <label>Voice-over</label>
    <select id="voiceOver" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="Tengo la locuci√≥n">Tengo la locuci√≥n</option>
      <option value="Hay que grabarla">Hay que grabarla</option>
    </select>

    <label>Dise√±o de miniaturas, car√°tulas o assets gr√°ficos</label>
    <select id="assets" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="S√≠">S√≠</option>
    </select>
  </fieldset>

  <fieldset>
    <legend><strong>5. Duraci√≥n y Entregables</strong></legend>
    <label for="duracionFinal">Duraci√≥n final del video (minutos)</label>
    <input type="number" id="duracionFinal" min="1" max="600" required>

    <label for="versiones">Cantidad de versiones necesarias</label>
    <input type="number" id="versiones" min="1" max="10" required>

    <label>¬øNecesitas varios cortes del mismo video?</label>
    <select id="cortes" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="S√≠">S√≠</option>
    </select>

    <label for="formatoEntrega">Formato o resoluci√≥n de entrega</label>
    <input type="text" id="formatoEntrega" placeholder="Ej: MP4 1080p" required>
  </fieldset>

  <fieldset>
    <legend><strong>6. Tiempos</strong></legend>
    <label for="fechaEntrega">Fecha de entrega deseada</label>
    <input type="date" id="fechaEntrega" required>

    <label for="revisiones">Cantidad de rondas de revisiones</label>
    <input type="number" id="revisiones" min="0" max="10" value="1" required>

    <label for="primerVersion">D√≠as para la primera versi√≥n</label>
    <input type="number" id="primerVersion" min="0" max="30" value="3" required>
  </fieldset>

  <fieldset>
    <legend><strong>7. Presupuesto y Forma de Pago</strong></legend>
    <label for="presupuestoEstimado">Presupuesto estimado (opcional)</label>
    <input type="number" id="presupuestoEstimado" min="0" placeholder="Si no, d√©jalo vac√≠o">

    <label>Facturaci√≥n por</label>
    <select id="facturacion" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="Proyecto">Proyecto</option>
      <option value="Hora">Hora</option>
      <option value="Minuto final">Minuto final</option>
      <option value="Mensualidad">Mensualidad</option>
    </select>
  </fieldset>

  <fieldset>
    <legend><strong>üßæ Retenci√≥n de Cliente (Opcional)</strong></legend>
    <label for="videosMes">Videos por mes</label>
    <input type="number" id="videosMes" min="0" max="100" placeholder="Si solo uno, pon 1">

    <label>¬øBuscas trabajo a largo plazo?</label>
    <select id="trabajoLargoPlazo" required>
      <option value="" disabled selected>Selecciona</option>
      <option value="No">No</option>
      <option value="S√≠">S√≠</option>
    </select>
  </fieldset>

  <button type="submit">Calcular Presupuesto</button>
  <button type="button" id="btnGenerarPDF" style="margin-left:1rem;">Generar PDF para Cliente</button>

</form>

<div id="resultado" style="display:none;"></div>
<div id="error" style="display:none;"></div>

<div id="historialContainer" style="display:none;">
  <h2>üìÅ Historial Interno de Presupuestos</h2>
  <button id="btnVerHistorial">Mostrar/Ocultar Historial</button>
  <table id="tablaHistorial" style="margin-top:1rem;">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Tipo</th>
        <th>Duraci√≥n (min)</th>
        <th>Horas Estimadas</th>
        <th>Precio Base</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  (() => {
    const { jsPDF } = window.jspdf;

    // Funciones para c√°lculo estimado de horas basado en respuestas y dificultad
    function calcularHoras(formData) {
      let horasBase = 0;

      // 1. Tipo de edici√≥n - impacto alto en horas
      switch (formData.tipoEdicion) {
        case "R√°pida para redes": horasBase += 2; break;
        case "Documental": horasBase += 15; break;
        case "Corporativa": horasBase += 10; break;
        case "Emocional": horasBase += 12; break;
        case "Cinematogr√°fica": horasBase += 20; break;
        default: horasBase += 8; break;
      }

      // 2. Material desorganizado agrega tiempo
      if (formData.organizacionMaterial === "Hay que limpiar y seleccionar") horasBase += 5;

      // 3. Efectos / Motion graphics / Animaci√≥n
      switch(formData.efectos) {
        case "No": horasBase += 0; break;
        case "Efectos simples": horasBase += 4; break;
        case "Motion graphics/animaci√≥n avanzada": horasBase += 12; break;
      }

      // 4. Edici√≥n multic√°mara
      if (formData.multicamara === "S√≠") horasBase += 6;

      // 5. Subt√≠tulos personalizados
      if (formData.subtitulos === "Personalizados") horasBase += 3;
      if (formData.subtitulos === "Autom√°ticos") horasBase += 1;

      // 6. Voice-over a grabar
      if (formData.voiceOver === "Hay que grabarla") horasBase += 4;

      // 7. Dise√±o de assets gr√°ficos
      if (formData.assets === "S√≠") horasBase += 3;

      // 8. Cortes adicionales
      if (formData.cortes === "S√≠") horasBase += 3;

      // 9. Duraci√≥n del video (en minutos)
      horasBase += formData.duracionFinal * 0.15;

      // 10. Versiones extra (cada versi√≥n suma tiempo)
      horasBase += (formData.versiones - 1) * 1.5;

      // 11. Revisiones (cada ronda suma tiempo)
      horasBase += formData.revisiones * 1;

      // 12. D√≠as para primera versi√≥n (m√°s r√°pido suele ser m√°s horas por presi√≥n)
      if (formData.primerVersion <= 2) horasBase += 5;
      else if (formData.primerVersion <= 5) horasBase += 2;

      return horasBase;
    }

    // Clasificaci√≥n de dificultad seg√∫n horas estimadas
    function clasificarDificultad(horas) {
      if (horas <= 5) return "Principiante";
      else if (horas <= 15) return "Intermedio";
      else return "Avanzado";
    }

    // C√°lculo de precio base (ejemplo simple: tarifa fija x horas)
    function calcularPrecio(horas, facturacion) {
      const tarifaHora = 25; // USD o moneda local, ajustar seg√∫n necesidad
      switch(facturacion) {
        case "Hora":
          return horas * tarifaHora;
        case "Proyecto":
          return horas * tarifaHora * 1.2; // tarifa algo mayor para proyecto cerrado
        case "Minuto final":
          return horas * tarifaHora * 1.5;
        case "Mensualidad":
          return horas * tarifaHora * 20; // ejemplo mensualidad (tarifa por hora * 20)
        default:
          return horas * tarifaHora;
      }
    }

    // Mostrar resultado en pantalla
    function mostrarResultado(precio, horas, dificultad) {
      const div = document.getElementById("resultado");
      div.style.display = "block";
      div.innerHTML = `
        <strong>Estimaci√≥n para el proyecto:</strong><br>
        Precio base estimado: <strong>$${precio.toFixed(2)}</strong><br>
        Horas aproximadas de trabajo: <strong>${horas.toFixed(1)} hrs</strong><br>
        Nivel de dificultad: <strong>${dificultad}</strong>
      `;
    }

    // Guardar en historial localStorage
    function guardarHistorial(entry) {
      const historial = JSON.parse(localStorage.getItem("historialPresupuestos") || "[]");
      historial.push(entry);
      localStorage.setItem("historialPresupuestos", JSON.stringify(historial));
    }

    // Mostrar historial
    function mostrarHistorial() {
      const historial = JSON.parse(localStorage.getItem("historialPresupuestos") || "[]");
      const tbody = document.querySelector("#tablaHistorial tbody");
      tbody.innerHTML = "";
      historial.slice(-20).reverse().forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${new Date(item.fecha).toLocaleString()}</td>
          <td>${item.tipoEdicion}</td>
          <td>${item.duracionFinal}</td>
          <td>${item.horas.toFixed(1)}</td>
          <td>$${item.precio.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Generar PDF con jsPDF
    function generarPDF(formData, precio, horas, dificultad) {
      const doc = new jsPDF();
      const fechaHoy = new Date();
      const fechaLimite = new Date(fechaHoy.getTime() + 7 * 24 * 60 * 60 * 1000); // +7 d√≠as

      // Logo placeholder
      doc.setFillColor(220, 220, 220);
      doc.rect(15, 10, 50, 20, "F");
      doc.setFontSize(14);
      doc.setTextColor(100);
      doc.text("LOGO AQU√ç", 40, 23, { align: "center" });

      doc.setFontSize(22);
      doc.setTextColor(33, 37, 41);
      doc.text("Presupuesto de Edici√≥n de Video", 105, 45, { align: "center" });

      doc.setFontSize(12);
      doc.setTextColor(55);
      doc.text(`Fecha emisi√≥n: ${fechaHoy.toLocaleDateString()}`, 15, 60);

      doc.text(`Validez de oferta: 7 d√≠as (hasta ${fechaLimite.toLocaleDateString()})`, 15, 67);

      doc.setLineWidth(0.5);
      doc.line(15, 70, 195, 70);

      doc.setFontSize(14);
      doc.text("Detalles del Proyecto:", 15, 80);

      // Mostrar datos relevantes para cliente (sin detalles t√©cnicos)
      const lines = [
        `- Objetivo: ${formData.objetivo}`,
        `- Publicaci√≥n: ${formData.publicacion}`,
        `- P√∫blico objetivo: ${formData.publico}`,
        `- Duraci√≥n final: ${formData.duracionFinal} minutos`,
        `- Formato entrega: ${formData.formatoEntrega}`,
        `- Fecha entrega: ${formData.fechaEntrega}`,
        `- Precio final: $${precio.toFixed(2)}`,
      ];
      let y = 90;
      lines.forEach(line => {
        doc.text(line, 20, y);
        y += 8;
      });

      doc.setFontSize(12);
      doc.setTextColor(100);
      doc.text("Gracias por confiar en nuestro servicio de edici√≥n.", 15, y + 10);

      // Opcional: detalles internos ocultos (solo para PDF interno)
      // Si quer√©s, pod√©s generar otro PDF con detalles t√©cnicos para uso interno.

      doc.save(`Presupuesto_Proyecto_${fechaHoy.toISOString().slice(0,10)}.pdf`);
    }

    document.getElementById("presupuestoForm").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;

      // Recolectar datos del formulario
      const formData = {
        objetivo: form.objetivo.value,
        publicacion: form.publicacion.value.trim(),
        publico: form.publico.value.trim(),
        referenciaEstilo: form.referenciaEstilo.value.trim(),

        materialGrabado: form.materialGrabado.value,
        formatoMaterial: form.formatoMaterial.value.trim(),
        resolucionMaterial: form.resolucionMaterial.value.trim(),
        organizacionMaterial: form.organizacionMaterial.value,

        tipoEdicion: form.tipoEdicion.value,
        efectos: form.efectos.value,
        multicamara: form.multicamara.value,

        subtitulos: form.subtitulos.value,
        musica: form.musica.value,
        voiceOver: form.voiceOver.value,
        assets: form.assets.value,

        duracionFinal: Number(form.duracionFinal.value),
        versiones: Number(form.versiones.value),
        cortes: form.cortes.value,

        formatoEntrega: form.formatoEntrega.value.trim(),

        fechaEntrega: form.fechaEntrega.value,
        revisiones: Number(form.revisiones.value),
        primerVersion: Number(form.primerVersion.value),

        presupuestoEstimado: form.presupuestoEstimado.value ? Number(form.presupuestoEstimado.value) : null,
        facturacion: form.facturacion.value,

        videosMes: form.videosMes.value ? Number(form.videosMes.value) : 0,
        trabajoLargoPlazo: form.trabajoLargoPlazo.value,
      };

      // Validaciones r√°pidas
      if (formData.duracionFinal <= 0) {
        mostrarError("La duraci√≥n final debe ser mayor que cero.");
        return;
      }
      if (formData.versiones <= 0) {
        mostrarError("Las versiones deben ser al menos 1.");
        return;
      }
      if (!formData.fechaEntrega) {
        mostrarError("Ingrese la fecha de entrega.");
        return;
      }

      // Calcular horas, dificultad y precio
      const horas = calcularHoras(formData);
      const dificultad = clasificarDificultad(horas);
      const precio = calcularPrecio(horas, formData.facturacion);

      mostrarResultado(precio, horas, dificultad);

      // Guardar en historial interno con fecha
      guardarHistorial({
        fecha: new Date().toISOString(),
        tipoEdicion: formData.tipoEdicion,
        duracionFinal: formData.duracionFinal,
        horas,
        precio,
      });

      // Mostrar historial si visible
      if (document.getElementById("historialContainer").style.display !== "none") {
        mostrarHistorial();
      }

      ocultarError();
    });

    function mostrarError(msg) {
      const err = document.getElementById("error");
      err.style.display = "block";
      err.textContent = msg;
    }
    function ocultarError() {
      const err = document.getElementById("error");
      err.style.display = "none";
      err.textContent = "";
    }

    // Bot√≥n mostrar/ocultar historial
    document.getElementById("btnVerHistorial").addEventListener("click", () => {
      const cont = document.getElementById("historialContainer");
      if (cont.style.display === "none" || cont.style.display === "") {
        cont.style.display = "block";
        mostrarHistorial();
      } else {
        cont.style.display = "none";
      }
    });

    // Bot√≥n generar PDF para cliente
    document.getElementById("btnGenerarPDF").addEventListener("click", () => {
      const form = document.getElementById("presupuestoForm");
      const formData = {
        objetivo: form.objetivo.value,
        publicacion: form.publicacion.value.trim(),
        publico: form.publico.value.trim(),
        referenciaEstilo: form.referenciaEstilo.value.trim(),

        materialGrabado: form.materialGrabado.value,
        formatoMaterial: form.formatoMaterial.value.trim(),
        resolucionMaterial: form.resolucionMaterial.value.trim(),
        organizacionMaterial: form.organizacionMaterial.value,

        tipoEdicion: form.tipoEdicion.value,
        efectos: form.efectos.value,
        multicamara: form.multicamara.value,

        subtitulos: form.subtitulos.value,
        musica: form.musica.value,
        voiceOver: form.voiceOver.value,
        assets: form.assets.value,

        duracionFinal: Number(form.duracionFinal.value),
        versiones: Number(form.versiones.value),
        cortes: form.cortes.value,

        formatoEntrega: form.formatoEntrega.value.trim(),

        fechaEntrega: form.fechaEntrega.value,
        revisiones: Number(form.revisiones.value),
        primerVersion: Number(form.primerVersion.value),

        presupuestoEstimado: form.presupuestoEstimado.value ? Number(form.presupuestoEstimado.value) : null,
        facturacion: form.facturacion.value,

        videosMes: form.videosMes.value ? Number(form.videosMes.value) : 0,
        trabajoLargoPlazo: form.trabajoLargoPlazo.value,
      };

      const horas = calcularHoras(formData);
      const dificultad = clasificarDificultad(horas);
      const precio = calcularPrecio(horas, formData.facturacion);

      generarPDF(formData, precio, horas, dificultad);
    });

  })();
</script>

</body>
</html>
