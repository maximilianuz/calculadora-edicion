<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate-key="pageTitle">Lupa Editions | Calculadora de Presupuestos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* --- ESTILOS (sin cambios, se mantienen los de la versi√≥n anterior) --- */
        :root {
            --bg-color: #f9fafb; --text-color: #111827; --card-bg: #ffffff;
            --border-color: #d1d5db; --primary-color: #3b82f6; --primary-hover: #2563eb;
            --label-color: #374151; --header-color: #1f2937; --subtle-text: #6b7280;
            --success-bg: #10b981; --success-text: #ffffff; --info-bg: #e0f2fe;
            --info-text: #075985;
            --danger-bg: #fee2e2; --danger-text: #991b1b;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827; --text-color: #f9fafb; --card-bg: #1f2937;
                --border-color: #4b5563; --primary-color: #60a5fa; --primary-hover: #3b82f6;
                --label-color: #d1d5db; --header-color: #f9fafb; --subtle-text: #9ca3af;
                --success-bg: #10b981; --success-text: #ffffff; --info-bg: #0c4a6e;
                --info-text: #e0f2fe;
                --danger-bg: #450a0a; --danger-text: #fecaca;
            }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0 auto; padding: 2rem; background-color: var(--bg-color); color: var(--text-color); max-width: 900px; }
        header { text-align: center; margin-bottom: 2rem; position: relative; }
        .lang-switcher { position: absolute; top: 0; right: 0; display: flex; gap: 0.5rem; }
        .lang-switcher button { background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 6px; padding: 0.4rem 0.6rem; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .lang-switcher button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        #company-logo { max-width: 220px; height: auto; margin-bottom: 1rem; border-radius: 8px; }
        h1, h2, h3 { color: var(--header-color); text-align: center; }
        form, #resultado-container { background-color: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-bottom: 2rem; }
        fieldset { border: 1px solid var(--border-color); padding: 1.5rem; margin: 0 0 1.5rem 0; border-radius: 8px; }
        legend { font-size: 1.25rem; font-weight: 600; color: var(--header-color); padding: 0 0.5rem; margin-left: 1rem; }
        label { font-weight: 600; display: block; margin: 1rem 0 0.5rem; color: var(--label-color); }
        input, select, textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; background-color: var(--bg-color); color: var(--text-color); box-sizing: border-box; transition: border-color 0.3s, box-shadow 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent); }
        .input-group { display: flex; gap: 1rem; align-items: center; margin-top: 1rem; }
        .input-group label { margin: 0; font-weight: normal; }
        .input-group input[type="checkbox"] { width: auto; }
        .button-group { display: flex; gap: 1rem; margin-top: 1.5rem; }
        button { background-color: var(--primary-color); color: white; border: none; border-radius: 8px; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; flex-grow: 1; }
        button:hover { background-color: var(--primary-hover); }
        button:active { transform: scale(0.98); }
        #btnGenerarPDF { background-color: var(--success-bg); color: var(--success-text); }
        #btnGenerarPDF:hover { background-color: color-mix(in srgb, var(--success-bg) 85%, black); }
        button:disabled { background-color: var(--border-color); cursor: not-allowed; }
        #resultado { background-color: var(--info-bg); color: var(--info-text); padding: 1.5rem; border-radius: 8px; }
        #resultado h3 { margin-top: 0; color: var(--header-color);}
        #resultado p strong { color: var(--header-color); }
        #resultado ul { list-style-type: '‚úì'; padding-left: 20px; }
        #resultado li { margin-bottom: 0.5rem; }
        .descuento { color: var(--danger-text); background-color: var(--danger-bg); padding: 0.2rem 0.5rem; border-radius: 6px; font-weight: bold; }
        #resultado-total { font-size: 1.5rem; font-weight: bold; text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid color-mix(in srgb, var(--info-text) 25%, transparent);}
        .hidden { display: none; }
        .campo-dinamico {
            padding-left: 1.5rem;
            border-left: 3px solid var(--primary-color);
            margin-top: 1rem;
            padding-top: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="lang-switcher">
            <button id="btn-lang-es" class="active">ES</button>
            <button id="btn-lang-en">EN</button>
        </div>
        <img id="company-logo" src="https://i.postimg.cc/t7Tfd4Wy/LOGO-FINAL.jpg" alt="Lupa Editions Logo"/>
        <h1 data-translate-key="mainHeader">Lupa Editions | Calculadora de Presupuestos</h1>
        <p style="color:var(--subtle-text);" data-translate-key="subHeader">Genera presupuestos profesionales y autom√°ticos.</p>
    </header>

    <form id="presupuestoForm" autocomplete="off" novalidate>
        <fieldset>
            <legend data-translate-key="calculationModel">Modelo de C√°lculo</legend>
            <label for="tipoProyecto" data-translate-key="selectProjectType">Selecciona el tipo de proyecto</label>
            <select id="tipoProyecto" required>
                <option value="detallado" selected data-translate-key="projectTypeDetailed">Proyecto Detallado (Precio Fijo Autom√°tico)</option>
                <option value="reels" data-translate-key="projectTypeReels">Paquete de Reels / TikToks</option>
                <option value="corporativo" data-translate-key="projectTypeCorporate">Paquete de Video Corporativo</option>
                <option value="cursos" data-translate-key="projectTypeCourses">Paquete de Cursos / Formaciones</option>
                <option value="motion" data-translate-key="projectTypeMotion">Paquete de Motion Graphics / AE</option>
                <option value="vsl" data-translate-key="projectTypeVSL">Paquete de VSL (Video Sales Letter)</option>
            </select>
        </fieldset>
        
        <div id="container-por-proyecto" class="hidden">
            <fieldset>
                <legend data-translate-key="packageDetails">Detalles del Paquete</legend>
                <label for="nombreClienteProyecto" data-translate-key="clientProjectName">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteProyecto" data-translate-key-placeholder="clientProjectNamePlaceholder1">
                
                <div id="campo-duracion-cursos" class="hidden">
                    <label for="duracionFinalCursos" data-translate-key="packageTotalDuration">Duraci√≥n final total (minutos)</label>
                    <input type="number" id="duracionFinalCursos" min="1" value="10">
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="additionalFeatures">Caracter√≠sticas Adicionales</legend>
                <p style="color:var(--subtle-text); font-size: 0.9rem; margin-top: -1rem; margin-bottom: 1rem;" data-translate-key="additionalFeaturesDesc">Cada opci√≥n seleccionada ajustar√° el precio autom√°ticamente.</p>
                <div class="input-group">
                    <input type="checkbox" id="paquete_graficos">
                    <label for="paquete_graficos" data-translate-key="featureGraphics">Gr√°ficos y T√≠tulos Animados</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_color">
                    <label for="paquete_color" data-translate-key="featureColor">Correcci√≥n de Color Avanzada</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="paquete_musica">
                    <label for="paquete_musica" data-translate-key="featureMusic">B√∫squeda de M√∫sica de Librer√≠a</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_formatos">
                    <label for="paquete_formatos" data-translate-key="featureFormats">M√∫ltiples Formatos (ej. vertical y horizontal)</label>
                </div>
            </fieldset>
        </div>

        <div id="container-detallado">
            <fieldset>
                <legend data-translate-key="section1Title">üß† 1. Contexto General</legend>
                <label for="nombreClienteDetallado" data-translate-key="clientProjectName">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteDetallado" required data-translate-key-placeholder="clientProjectNamePlaceholder2">
                <label for="objetivo" data-translate-key="section1Objective">Objetivo del video y d√≥nde se publicar√°</label>
                <textarea id="objetivo" rows="3" data-translate-key-placeholder="section1ObjectivePlaceholder"></textarea>
            </fieldset>
             <fieldset>
                <legend data-translate-key="section2Title">üì¶ 2. Material a Editar</legend>
                <label for="duracionBruto" data-translate-key="section2RawDuration">Duraci√≥n total aproximada del material en bruto (minutos)</label>
                <input type="number" id="duracionBruto" min="0" value="30" required>
                <label for="organizacionMaterial" data-translate-key="section2Organization">Organizaci√≥n del material</label>
                <select id="organizacionMaterial">
                    <option value="organizado" data-translate-key="section2OrgOrganized">Organizado (pre-seleccionado y clasificado)</option>
                    <option value="desorganizado" selected data-translate-key="section2OrgDisorganized">Desorganizado (hay que seleccionar y limpiar)</option>
                </select>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section3Title">‚úÇÔ∏è 3. Tipo de Edici√≥n</legend>
                <label for="tipoEdicion" data-translate-key="section3Style">Estilo principal de edici√≥n</label>
                <select id="tipoEdicion">
                    <option value="rapida_redes" data-translate-key="section3StyleSocial">R√°pida para Redes (Din√°mica, con zooms, subt√≠tulos virales)</option>
                    <option value="corporativa" selected data-translate-key="section3StyleCorporate">Corporativa / Documental (Clara, profesional, ritmo pausado)</option>
                    <option value="emocional" data-translate-key="section3StyleCinematic">Emocional / Cinematogr√°fica (Correcci√≥n de color avanzada, sound design)</option>
                </select>
                 <div class="input-group">
                    <input type="checkbox" id="multicam">
                    <label for="multicam" data-translate-key="section3Multicam">¬øSe necesita edici√≥n multic√°mara?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="motionGraphics">
                    <label for="motionGraphics" data-translate-key="section3Motion">¬øIncluir√° Motion Graphics / Animaci√≥n (After Effects)?</label>
                </div>
                <div id="campo-complejidad-motion" class="hidden campo-dinamico">
                     <label for="complejidadMotion" data-translate-key="section3MotionComplexity">Complejidad de los Motion Graphics</label>
                     <select id="complejidadMotion">
                         <option value="baja" data-translate-key="section3MotionLow">Baja (T√≠tulos, tercios inferiores animados)</option>
                         <option value="media" data-translate-key="section3MotionMid">Media (Animaci√≥n de logos, transiciones personalizadas)</option>
                         <option value="alta" data-translate-key="section3MotionHigh">Alta (Explicaciones animadas complejas, tracking, VFX)</option>
                     </select>
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section4Title">üî† 4. Elementos Extra</legend>
                <label for="subtitulos" data-translate-key="section4Subtitles">Subt√≠tulos</label>
                <select id="subtitulos">
                    <option value="no" data-translate-key="section4SubtitlesNo">No necesarios</option>
                    <option value="automaticos" data-translate-key="section4SubtitlesAuto">Autom√°ticos (con revisi√≥n)</option>
                    <option value="personalizados" data-translate-key="section4SubtitlesCustom">Personalizados (animados, estilo de marca)</option>
                </select>
                <div class="input-group">
                    <input type="checkbox" id="busquedaMusica">
                    <label for="busquedaMusica" data-translate-key="section4Music">¬øNecesita b√∫squeda y licenciamiento de m√∫sica?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="voiceOver">
                    <label for="voiceOver" data-translate-key="section4VO">¬øSe necesita grabaci√≥n y edici√≥n de Voice-over?</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="disenoMiniatura">
                    <label for="disenoMiniatura" data-translate-key="section4Thumbnail">¬øNecesita dise√±o de miniatura/car√°tula (Thumbnail)?</label>
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section5Title">üìè 5. Entregables y Plazos</legend>
                <label for="duracionFinal" data-translate-key="section5Duration">Duraci√≥n final estimada del video principal (minutos)</label>
                <input type="number" id="duracionFinal" min="1" value="2" required>
                <label for="versionesAdicionales" data-translate-key="section5Versions">¬øCu√°ntas versiones adicionales se necesitan?</label>
                <input type="number" id="versionesAdicionales" min="0" value="1" data-translate-key-placeholder="section5VersionsPlaceholder">
                 <label for="plazoEntrega" data-translate-key="section5Deadline">Plazo de entrega</label>
                <select id="plazoEntrega">
                    <option value="normal" data-translate-key="section5DeadlineNormal">Normal (M√°s de 1 semana)</option>
                    <option value="urgente" data-translate-key="section5DeadlineUrgent">Urgente (3-7 d√≠as)</option>
                    <option value="muy_urgente" data-translate-key="section5DeadlineVeryUrgent">Muy Urgente (Menos de 72 horas)</option>
                </select>
                 <label for="rondasRevision" data-translate-key="section5Revisions">Rondas de cambios incluidas</label>
                <input type="number"id="rondasRevision" min="0" value="2">
            </fieldset>
        </div>
        
        <fieldset>
             <legend data-translate-key="finalParameters">üíµ Par√°metros Finales</legend>
             <label for="moneda" data-translate-key="currency">Moneda del Presupuesto</label>
             <input type="text" id="moneda" value="USD" required data-translate-key-placeholder="currencyPlaceholder">
             <div class="input-group">
                <input type="checkbox" id="acuerdoMensual">
                <label for="acuerdoMensual" data-translate-key="monthlyDiscountLabel">Aplicar descuento del 15% por acuerdo de pago mensual (Retainer)</label>
            </div>
        </fieldset>

        <div class="button-group">
            <button type="submit" data-translate-key="calculateButton">Calcular Presupuesto</button>
            <button type="button" id="btnGenerarPDF" disabled data-translate-key="generatePDFButton">Generar PDF Profesional</button>
        </div>
    </form>

    <div id="resultado-container" class="hidden">
        <h2 data-translate-key="resultsTitle">üìä Resumen del Presupuesto</h2>
        <div id="resultado"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- PAR√ÅMETROS GLOBALES Y DE CONTACTO ---
        const TARIFA_HORA_INTERNA = 40; 
        const DESCUENTO_MENSUAL = 0.15;
        let currentLanguage = 'es';
        let budgetData = {}; 
        
        // ===================================================================
        // ==  ‚Üì‚Üì‚Üì  AQU√ç PUEDES EDITAR TUS DATOS DE CONTACTO  ‚Üì‚Üì‚Üì  ==
        // ===================================================================
        const CONTACT_EMAIL = "tuemail@ejemplo.com";
        const CONTACT_WEBSITE = "www.tupagina.com";
        // ===================================================================

        const translations = {
            es: {
                // ... (Otras traducciones sin cambios) ...
                pdfFooter: `Lupa Editions | Contacto: ${CONTACT_EMAIL} | ${CONTACT_WEBSITE}`,
                pageTitle: "Lupa Editions | Calculadora de Presupuestos",
                mainHeader: "Lupa Editions | Calculadora de Presupuestos",
                subHeader: "Genera presupuestos profesionales y autom√°ticos.",
                calculationModel: "Modelo de C√°lculo",
                selectProjectType: "Selecciona el tipo de proyecto",
                projectTypeDetailed: "Proyecto Detallado (Precio Fijo Autom√°tico)",
                projectTypeReels: "Paquete de Reels / TikToks",
                projectTypeCorporate: "Paquete de Video Corporativo",
                projectTypeCourses: "Paquete de Cursos / Formaciones",
                projectTypeMotion: "Paquete de Motion Graphics / AE",
                projectTypeVSL: "Paquete de VSL (Video Sales Letter)",
                packageDetails: "Detalles del Paquete",
                clientProjectName: "Nombre del Cliente / Proyecto",
                clientProjectNamePlaceholder1: "Ej: Marca Creativa - Campa√±a Reels Q3",
                clientProjectNamePlaceholder2: "Ej: Video Promocional para Web",
                packageTotalDuration: "Duraci√≥n final total (minutos)",
                additionalFeatures: "Caracter√≠sticas Adicionales",
                additionalFeaturesDesc: "Cada opci√≥n seleccionada ajustar√° el precio autom√°ticamente.",
                featureGraphics: "Gr√°ficos y T√≠tulos Animados",
                featureColor: "Correcci√≥n de Color Avanzada",
                featureMusic: "B√∫squeda de M√∫sica de Librer√≠a",
                featureFormats: "M√∫ltiples Formatos (ej. vertical y horizontal)",
                section1Title: "üß† 1. Contexto General",
                section1Objective: "Objetivo del video y d√≥nde se publicar√°",
                section1ObjectivePlaceholder: "Ej: Video promocional para la home de la web y campa√±a de redes sociales (Instagram, YouTube).",
                section2Title: "üì¶ 2. Material a Editar",
                section2RawDuration: "Duraci√≥n total aproximada del material en bruto (minutos)",
                section2Organization: "Organizaci√≥n del material",
                section2OrgOrganized: "Organizado (pre-seleccionado y clasificado)",
                section2OrgDisorganized: "Desorganizado (hay que seleccionar y limpiar)",
                section3Title: "‚úÇÔ∏è 3. Tipo de Edici√≥n",
                section3Style: "Estilo principal de edici√≥n",
                section3StyleSocial: "R√°pida para Redes (Din√°mica, con zooms, subt√≠tulos virales)",
                section3StyleCorporate: "Corporativa / Documental (Clara, profesional, ritmo pausado)",
                section3StyleCinematic: "Emocional / Cinematogr√°fica (Correcci√≥n de color avanzada, sound design)",
                section3Multicam: "¬øSe necesita edici√≥n multic√°mara?",
                section3Motion: "¬øIncluir√° Motion Graphics / Animaci√≥n (After Effects)?",
                section3MotionComplexity: "Complejidad de los Motion Graphics",
                section3MotionLow: "Baja (T√≠tulos, tercios inferiores animados)",
                section3MotionMid: "Media (Animaci√≥n de logos, transiciones personalizadas)",
                section3MotionHigh: "Alta (Explicaciones animadas complejas, tracking, VFX)",
                section4Title: "üî† 4. Elementos Extra",
                section4Subtitles: "Subt√≠tulos",
                section4SubtitlesNo: "No necesarios",
                section4SubtitlesAuto: "Autom√°ticos (con revisi√≥n)",
                section4SubtitlesCustom: "Personalizados (animados, estilo de marca)",
                section4Music: "¬øNecesita b√∫squeda y licenciamiento de m√∫sica?",
                section4VO: "¬øSe necesita grabaci√≥n y edici√≥n de Voice-over?",
                section4Thumbnail: "¬øNecesita dise√±o de miniatura/car√°tula (Thumbnail)?",
                section5Title: "üìè 5. Entregables y Plazos",
                section5Duration: "Duraci√≥n final estimada del video principal (minutos)",
                section5Versions: "¬øCu√°ntas versiones adicionales se necesitan?",
                section5VersionsPlaceholder: "Ej: 1 (para formato vertical)",
                section5Deadline: "Plazo de entrega",
                section5DeadlineNormal: "Normal (M√°s de 1 semana)",
                section5DeadlineUrgent: "Urgente (3-7 d√≠as)",
                section5DeadlineVeryUrgent: "Muy Urgente (Menos de 72 horas)",
                section5Revisions: "Rondas de cambios incluidas",
                finalParameters: "üíµ Par√°metros Finales",
                currency: "Moneda del Presupuesto",
                currencyPlaceholder: "Ej: USD, EUR, ARS",
                monthlyDiscountLabel: "Aplicar descuento del 15% por acuerdo de pago mensual (Retainer)",
                calculateButton: "Calcular Presupuesto",
                generatePDFButton: "Generar PDF Profesional",
                resultsTitle: "üìä Resumen del Presupuesto",
                resultsSubtotal: "Subtotal",
                resultsMonthlyDiscount: "Descuento Mensual (15%)",
                resultsFinalPrice: "Precio Final Estimado",
                resultsBasePrice: "Precio Base",
                resultsAdditionalFeatures: "Caracter√≠sticas Adicionales",
                resultsTimeBreakdown: "Desglose de Tiempo Estimado",
                resultsTotalHours: "Total Horas Estimadas",
                pdfTitle: "PROPUESTA DE EDICI√ìN DE VIDEO",
                pdfDate: "Fecha",
                pdfClient: "Cliente",
                pdfIntro: "Estimado/a {clientName},\n\nGracias por considerar a Lupa Editions para su proyecto de video. Nos complace presentarle la siguiente propuesta detallada, elaborada en base a los requerimientos que nos ha compartido.",
                pdfScope: "Alcance del Proyecto",
                pdfConcept: "Concepto",
                pdfDetail: "Detalle",
                pdfProjectType: "Tipo de Proyecto",
                pdfFeatures: "Caracter√≠sticas Incluidas",
                pdfStdEditing: "Edici√≥n est√°ndar",
                pdfObjective: "Objetivo Principal",
                pdfEditingStyle: "Estilo de Edici√≥n",
                pdfEstDuration: "Duraci√≥n Estimada",
                pdfDeliverables: "Entregables",
                pdfDeliverablesText: "1 video principal + {versions} versi√≥n(es) adicional(es)",
                pdfMotion: "Motion Graphics / AE",
                pdfMotionYes: "S√≠ ({complexity})",
                pdfMotionNo: "No",
                pdfRevisions: "Rondas de Revisi√≥n",
                pdfRevisionsText: "{revisions} incluidas",
                pdfInvestment: "Inversi√≥n del Proyecto",
                pdfSubtotal: "Subtotal:",
                pdfDiscount: "Descuento (Acuerdo Mensual 15%):",
                pdfFinalTotal: "Total Final:",
                pdfTerms: "T√©rminos y Pr√≥ximos Pasos",
                pdfTerm1: "Esta propuesta es v√°lida por 7 d√≠as. Los precios pueden ajustarse pasado este per√≠odo.",
                pdfTerm2: "El precio es final a menos que los requisitos del proyecto cambien significativamente.",
                pdfTerm3: "Forma de pago: 50% por adelantado para iniciar y 50% a la entrega del video final.",
                pdfTerm4: "Rondas de revisi√≥n adicionales o material no contemplado se presupuestar√°n por separado.",
                pdfStep1Title: "1. Aprobaci√≥n",
                pdfStep1Desc: "Confirmar esta propuesta por correo.",
                pdfStep2Title: "2. Pago Inicial",
                pdfStep2Desc: "Realizar el pago del 50% para agendar el proyecto.",
                pdfStep3Title: "3. Kickoff",
                pdfStep3Desc: "Coordinaremos una reuni√≥n inicial para alinear detalles.",
            },
            en: {
                // ... (Otras traducciones sin cambios) ...
                pdfFooter: `Lupa Editions | Contact: ${CONTACT_EMAIL} | ${CONTACT_WEBSITE}`,
                pageTitle: "Lupa Editions | Budget Calculator",
                mainHeader: "Lupa Editions | Budget Calculator",
                subHeader: "Generate professional and automatic quotes.",
                calculationModel: "Calculation Model",
                selectProjectType: "Select the project type",
                projectTypeDetailed: "Detailed Project (Automatic Fixed Price)",
                projectTypeReels: "Reels / TikToks Package",
                projectTypeCorporate: "Corporate Video Package",
                projectTypeCourses: "Courses / Training Package",
                projectTypeMotion: "Motion Graphics / AE Package",
                projectTypeVSL: "VSL (Video Sales Letter) Package",
                packageDetails: "Package Details",
                clientProjectName: "Client / Project Name",
                clientProjectNamePlaceholder1: "Ex: Creative Brand - Q3 Reels Campaign",
                clientProjectNamePlaceholder2: "Ex: Promotional Video for Website",
                packageTotalDuration: "Total final duration (minutes)",
                additionalFeatures: "Additional Features",
                additionalFeaturesDesc: "Each selected option will automatically adjust the price.",
                featureGraphics: "Animated Graphics and Titles",
                featureColor: "Advanced Color Correction",
                featureMusic: "Stock Music Sourcing",
                featureFormats: "Multiple Formats (e.g., vertical & horizontal)",
                section1Title: "üß† 1. General Context",
                section1Objective: "Video's objective and where it will be published",
                section1ObjectivePlaceholder: "Ex: Promotional video for the website homepage and social media campaign (Instagram, YouTube).",
                section2Title: "üì¶ 2. Footage to Edit",
                section2RawDuration: "Approximate total duration of raw footage (minutes)",
                section2Organization: "Footage organization",
                section2OrgOrganized: "Organized (pre-selected and sorted)",
                section2OrgDisorganized: "Disorganized (footage needs to be sorted and selected)",
                section3Title: "‚úÇÔ∏è 3. Editing Type",
                section3Style: "Main editing style",
                section3StyleSocial: "Fast-Paced for Social Media (Dynamic, zooms, viral subtitles)",
                section3StyleCorporate: "Corporate / Documentary (Clean, professional, steady pace)",
                section3StyleCinematic: "Emotional / Cinematic (Advanced color grading, sound design)",
                section3Multicam: "Is multi-camera editing required?",
                section3Motion: "Include Motion Graphics / Animation (After Effects)?",
                section3MotionComplexity: "Motion Graphics Complexity",
                section3MotionLow: "Low (Titles, animated lower thirds)",
                section3MotionMid: "Medium (Logo animation, custom transitions)",
                section3MotionHigh: "High (Complex animated explanations, tracking, VFX)",
                section4Title: "üî† 4. Extra Elements",
                section4Subtitles: "Subtitles",
                section4SubtitlesNo: "Not required",
                section4SubtitlesAuto: "Automatic (with review)",
                section4SubtitlesCustom: "Custom (animated, branded style)",
                section4Music: "Need to source and license music?",
                section4VO: "Need to record and edit a Voice-over?",
                section4Thumbnail: "Need a thumbnail design?",
                section5Title: "üìè 5. Deliverables & Deadlines",
                section5Duration: "Estimated final duration of the main video (minutes)",
                section5Versions: "How many additional versions are needed?",
                section5VersionsPlaceholder: "Ex: 1 (for vertical format)",
                section5Deadline: "Delivery Deadline",
                section5DeadlineNormal: "Normal (More than 1 week)",
                section5DeadlineUrgent: "Urgent (3-7 days)",
                section5DeadlineVeryUrgent: "Very Urgent (Less than 72 hours)",
                section5Revisions: "Rounds of revisions included",
                finalParameters: "üíµ Final Parameters",
                currency: "Budget Currency",
                currencyPlaceholder: "Ex: USD, EUR, GBP",
                monthlyDiscountLabel: "Apply 15% discount for monthly retainer agreement",
                calculateButton: "Calculate Budget",
                generatePDFButton: "Generate Professional PDF",
                resultsTitle: "üìä Budget Summary",
                resultsSubtotal: "Subtotal",
                resultsMonthlyDiscount: "Monthly Discount (15%)",
                resultsFinalPrice: "Estimated Final Price",
                resultsBasePrice: "Base Price",
                resultsAdditionalFeatures: "Additional Features",
                resultsTimeBreakdown: "Estimated Time Breakdown",
                resultsTotalHours: "Total Estimated Hours",
                pdfTitle: "VIDEO EDITING PROPOSAL",
                pdfDate: "Date",
                pdfClient: "Client",
                pdfIntro: "Dear {clientName},\n\nThank you for considering Lupa Editions for your video project. We are pleased to present the following detailed proposal, based on the requirements you have shared with us.",
                pdfScope: "Project Scope",
                pdfConcept: "Concept",
                pdfDetail: "Detail",
                pdfProjectType: "Project Type",
                pdfFeatures: "Features Included",
                pdfStdEditing: "Standard editing",
                pdfObjective: "Main Objective",
                pdfEditingStyle: "Editing Style",
                pdfEstDuration: "Estimated Duration",
                pdfDeliverables: "Deliverables",
                pdfDeliverablesText: "1 main video + {versions} additional version(s)",
                pdfMotion: "Motion Graphics / AE",
                pdfMotionYes: "Yes ({complexity})",
                pdfMotionNo: "No",
                pdfRevisions: "Rounds of Revisions",
                pdfRevisionsText: "{revisions} included",
                pdfInvestment: "Project Investment",
                pdfSubtotal: "Subtotal:",
                pdfDiscount: "Discount (15% Retainer):",
                pdfFinalTotal: "Final Total:",
                pdfTerms: "Terms & Next Steps",
                pdfTerm1: "This proposal is valid for 7 days. Prices may be adjusted after this period.",
                pdfTerm2: "The price is final unless the project requirements change significantly.",
                pdfTerm3: "Payment terms: 50% upfront to start, and 50% upon final delivery.",
                pdfTerm4: "Additional revisions or material not covered will be quoted separately.",
                pdfStep1Title: "1. Approval",
                pdfStep1Desc: "Confirm this proposal by email.",
                pdfStep2Title: "2. Down Payment",
                pdfStep2Desc: "Make the 50% payment to schedule the project.",
                pdfStep3Title: "3. Kickoff",
                pdfStep3Desc: "We will coordinate an initial meeting to align details.",
            }
        };

        // --- SELECTORES DE ELEMENTOS ---
        const form = document.getElementById('presupuestoForm');
        const btnGenerarPDF = document.getElementById('btnGenerarPDF');
        const resultadoContainer = document.getElementById('resultado-container');
        const resultadoDiv = document.getElementById('resultado');
        const tipoProyecto = document.getElementById('tipoProyecto');
        const containerDetallado = document.getElementById('container-detallado');
        const containerPorProyecto = document.getElementById('container-por-proyecto');
        const motionGraphicsCheckbox = document.getElementById('motionGraphics');
        const campoComplejidadMotion = document.getElementById('campo-complejidad-motion');
        const campoDuracionCursos = document.getElementById('campo-duracion-cursos');
        const btnLangEs = document.getElementById('btn-lang-es');
        const btnLangEn = document.getElementById('btn-lang-en');
        
        // --- L√ìGICA DE TRADUCCI√ìN (SIN CAMBIOS) ---
        const setLanguage = (lang) => {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            btnLangEs.classList.toggle('active', lang === 'es');
            btnLangEn.classList.toggle('active', lang === 'en');

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            document.querySelectorAll('[data-translate-key-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-key-placeholder');
                 if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
        };

        // --- L√ìGICA DE VISIBILIDAD DEL FORMULARIO (SIN CAMBIOS) ---
        const updateFormVisibility = () => {
            const selectedType = tipoProyecto.value;
            if (selectedType === 'detallado') {
                containerDetallado.classList.remove('hidden');
                containerPorProyecto.classList.add('hidden');
            } else {
                containerDetallado.classList.add('hidden');
                containerPorProyecto.classList.remove('hidden');
                campoDuracionCursos.classList.toggle('hidden', selectedType !== 'cursos');
            }
            if (!resultadoContainer.classList.contains('hidden')) {
                calcularYMostrarPresupuesto();
            }
        };

        motionGraphicsCheckbox.addEventListener('change', () => {
            campoComplejidadMotion.classList.toggle('hidden', !motionGraphicsCheckbox.checked);
        });

        // --- L√ìGICA DE C√ÅLCULO DE PRESUPUESTO (SIN CAMBIOS) ---
        const calcularYMostrarPresupuesto = () => {
            let totalHoras = 0;
            let precioBase = 0;
            let desglose = [];
            let detalles = {};
            const moneda = document.getElementById('moneda').value || 'USD';
            const tipo = tipoProyecto.value;
            
            detalles.acuerdoMensual = document.getElementById('acuerdoMensual').checked;
            detalles.moneda = moneda;
            detalles.tipoProyecto = tipo;
            detalles.nombreProyecto = tipo === 'detallado' ?
                 document.getElementById('nombreClienteDetallado').value :
                 document.getElementById('nombreClienteProyecto').value;

            if (tipo === 'detallado') {
                const duracionBruto = parseFloat(document.getElementById('duracionBruto').value) || 0;
                const duracionFinal = parseFloat(document.getElementById('duracionFinal').value) || 0;
                let horasOrganizacion = duracionBruto / 10;
                if (document.getElementById('organizacionMaterial').value === 'organizado') {
                    horasOrganizacion *= 0.5;
                }
                totalHoras += horasOrganizacion;
                desglose.push(`Organizaci√≥n Material: ${horasOrganizacion.toFixed(1)}h`);
                let horasEdicionBase = duracionFinal * 3;
                totalHoras += horasEdicionBase;
                desglose.push(`Edici√≥n Base: ${horasEdicionBase.toFixed(1)}h`);
                const tipoEdicion = document.getElementById('tipoEdicion').value;
                if (tipoEdicion === 'rapida_redes') totalHoras *= 1.3;
                if (tipoEdicion === 'emocional') totalHoras *= 1.5;
                if (document.getElementById('multicam').checked) totalHoras += 2;
                if (document.getElementById('motionGraphics').checked) {
                    const complejidad = document.getElementById('complejidadMotion').value;
                    if (complejidad === 'baja') totalHoras += duracionFinal * 0.5;
                    if (complejidad === 'media') totalHoras += duracionFinal * 1;
                    if (complejidad === 'alta') totalHoras += duracionFinal * 2;
                }
                const subtitulos = document.getElementById('subtitulos').value;
                if (subtitulos === 'automaticos') totalHoras += duracionFinal * 0.3;
                if (subtitulos === 'personalizados') totalHoras += duracionFinal * 0.8;
                if (document.getElementById('busquedaMusica').checked) totalHoras += 1;
                if (document.getElementById('voiceOver').checked) totalHoras += 2;
                if (document.getElementById('disenoMiniatura').checked) totalHoras += 1.5;
                totalHoras += (parseFloat(document.getElementById('versionesAdicionales').value) || 0) * (totalHoras * 0.2);
                totalHoras += (parseFloat(document.getElementById('rondasRevision').value) || 0) * 0.75;
                const plazo = document.getElementById('plazoEntrega').value;
                if (plazo === 'urgente') totalHoras *= 1.25;
                if (plazo === 'muy_urgente') totalHoras *= 1.5;
                precioBase = totalHoras * TARIFA_HORA_INTERNA;
            } else {
                const preciosPaquetes = { reels: 150, corporativo: 600, cursos: 80, motion: 500, vsl: 400 };
                precioBase = preciosPaquetes[tipo];
                if (tipo === 'cursos') {
                    const duracionCursos = parseFloat(document.getElementById('duracionFinalCursos').value) || 0;
                    precioBase *= duracionCursos;
                }
                if (document.getElementById('paquete_graficos').checked) precioBase *= 1.25;
                if (document.getElementById('paquete_color').checked) precioBase *= 1.3;
                if (document.getElementById('paquete_musica').checked) precioBase += 50;
                if (document.getElementById('paquete_formatos').checked) precioBase *= 1.3;
            }
            
            const subtotal = precioBase;
            const descuento = detalles.acuerdoMensual ? subtotal * DESCUENTO_MENSUAL : 0;
            const totalFinal = subtotal - descuento;
            
            budgetData = { ...detalles, subtotal, descuento, totalFinal, totalHoras, desglose };

            let htmlResultado = ``;
            if (tipo === 'detallado') {
                htmlResultado += `<p><strong>${translations[currentLanguage].resultsTimeBreakdown}:</strong></p><ul>`;
                desglose.forEach(item => htmlResultado += `<li>${item}</li>`);
                htmlResultado += `</ul><p><strong>${translations[currentLanguage].resultsTotalHours}:</strong> ${totalHoras.toFixed(1)}h</p><hr>`;
            } else {
                 htmlResultado += `<p><strong>${translations[currentLanguage].resultsBasePrice}:</strong> ${subtotal.toFixed(2)} ${moneda}</p>`;
            }
            htmlResultado += `<div id="resultado-total">`;
            if (detalles.acuerdoMensual) {
                htmlResultado += `<p>${translations[currentLanguage].resultsSubtotal}: ${subtotal.toFixed(2)} ${moneda}</p>`;
                htmlResultado += `<p>${translations[currentLanguage].resultsMonthlyDiscount}: <span class="descuento">- ${descuento.toFixed(2)} ${moneda}</span></p>`;
            }
            htmlResultado += `<p><strong>${translations[currentLanguage].resultsFinalPrice}: ${totalFinal.toFixed(2)} ${moneda}</strong></p>`;
            htmlResultado += `</div>`;
            resultadoDiv.innerHTML = htmlResultado;
            resultadoContainer.classList.remove('hidden');
            btnGenerarPDF.disabled = false;
        };

        // --- L√ìGICA DE GENERACI√ìN DE PDF (CON CAMBIOS) ---
        const generarPDF = () => {
            if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                alert('Error: La librer√≠a jsPDF no se ha cargado correctamente.');
                return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const t = translations[currentLanguage]; 
            const clientName = budgetData.nombreProyecto || 'N/A';
            const logo = document.getElementById('company-logo');
            
            // --- CAMBIO #1: LOGO CENTRADO ---
            // Ancho del logo en el PDF
            const logoWidth = 50;
            // Calculamos la posici√≥n X para centrar el logo
            const pageWidth = doc.internal.pageSize.getWidth();
            const xPosition = (pageWidth - logoWidth) / 2;

            if(logo.complete) {
                // Usamos la nueva posici√≥n X calculada
                doc.addImage(logo, 'JPEG', xPosition, 15, logoWidth, 15);
            }

            // Cabecera (ajustada para estar debajo del logo centrado)
            doc.setFontSize(22);
            doc.setTextColor(31, 41, 55); 
            doc.text(t.pdfTitle, 105, 40, { align: 'center' }); // Bajamos un poco el t√≠tulo

            doc.setFontSize(11);
            doc.setTextColor(107, 114, 128); 
            doc.text(`${t.pdfDate}: ${new Date().toLocaleDateString()}`, 20, 55);
            doc.text(`${t.pdfClient}: ${clientName}`, 20, 62);
            
            // --- FIN DEL CAMBIO #1 ---

            // Introducci√≥n
            doc.setFontSize(11);
            doc.setTextColor(55, 65, 81); 
            const introText = t.pdfIntro.replace('{clientName}', clientName);
            const introLines = doc.splitTextToSize(introText, 170);
            doc.text(introLines, 20, 80); // Posici√≥n Y ajustada

            // El resto de la l√≥gica de las tablas y el contenido no cambia...
            let bodyData = [];
            const tipoProyectoTexto = document.querySelector(`#tipoProyecto option[value="${budgetData.tipoProyecto}"]`).textContent;
            
            if (budgetData.tipoProyecto === 'detallado') {
                const duracionFinal = document.getElementById('duracionFinal').value;
                const versiones = document.getElementById('versionesAdicionales').value;
                const rondas = document.getElementById('rondasRevision').value;
                const estiloEdicion = document.querySelector(`#tipoEdicion option[value="${document.getElementById('tipoEdicion').value}"]`).textContent;
                const motionChecked = document.getElementById('motionGraphics').checked;
                let motionText = t.pdfMotionNo;
                if(motionChecked) {
                    const comp = document.querySelector(`#complejidadMotion option[value="${document.getElementById('complejidadMotion').value}"]`).textContent;
                    motionText = t.pdfMotionYes.replace('{complexity}', comp);
                }
                bodyData = [
                    [t.pdfProjectType, tipoProyectoTexto],
                    [t.pdfObjective, document.getElementById('objetivo').value || 'N/A'],
                    [t.pdfEditingStyle, estiloEdicion],
                    [t.pdfEstDuration, `${duracionFinal} min`],
                    [t.pdfDeliverables, t.pdfDeliverablesText.replace('{versions}', versiones)],
                    [t.pdfMotion, motionText],
                    [t.pdfRevisions, t.pdfRevisionsText.replace('{revisions}', rondas)]
                ];
            } else {
                 const features = [];
                 if(document.getElementById('paquete_graficos').checked) features.push(t.featureGraphics);
                 if(document.getElementById('paquete_color').checked) features.push(t.featureColor);
                 if(document.getElementById('paquete_musica').checked) features.push(t.featureMusic);
                 if(document.getElementById('paquete_formatos').checked) features.push(t.featureFormats);

                 bodyData = [
                     [t.pdfProjectType, tipoProyectoTexto],
                     [t.pdfFeatures, features.length > 0 ? features.join(', ') : t.pdfStdEditing]
                 ];
                 if(budgetData.tipoProyecto === 'cursos'){
                     bodyData.push([t.packageTotalDuration, `${document.getElementById('duracionFinalCursos').value} min`]);
                 }
            }
            doc.autoTable({
                startY: 100, // Posici√≥n Y ajustada
                head: [[t.pdfScope]],
                body: bodyData,
                headStyles: { fillColor: [59, 130, 246] }, 
                columnStyles: { 0: { fontStyle: 'bold' } }
            });
            let finalY = doc.lastAutoTable.finalY + 15;
            
            let investmentData = [];
            if(budgetData.acuerdoMensual){
                investmentData.push([t.pdfSubtotal, `${budgetData.subtotal.toFixed(2)} ${budgetData.moneda}`]);
                investmentData.push([t.pdfDiscount, `-${budgetData.descuento.toFixed(2)} ${budgetData.moneda}`]);
            }
             investmentData.push([t.pdfFinalTotal, `${budgetData.totalFinal.toFixed(2)} ${budgetData.moneda}`]);
            doc.autoTable({
                startY: finalY,
                head: [[t.pdfInvestment]],
                body: investmentData,
                headStyles: { fillColor: [59, 130, 246] },
                bodyStyles: { hAlign: 'right' },
                columnStyles: { 0: { fontStyle: 'bold', hAlign: 'left' }, 1: { fontStyle: 'bold' } }
            });
            finalY = doc.lastAutoTable.finalY + 15;
            
            doc.setFontSize(14).setTextColor(31, 41, 55).text(t.pdfTerms, 20, finalY);
            finalY += 8;
            doc.setFontSize(10).setTextColor(107, 114, 128)
                .text(`‚Ä¢ ${t.pdfTerm1}`, 22, finalY)
                .text(`‚Ä¢ ${t.pdfTerm2}`, 22, finalY += 5)
                .text(`‚Ä¢ ${t.pdfTerm3}`, 22, finalY += 5)
                .text(`‚Ä¢ ${t.pdfTerm4}`, 22, finalY += 5);
            finalY += 12;
            doc.autoTable({
                startY: finalY,
                body: [
                    [t.pdfStep1Title, t.pdfStep2Title, t.pdfStep3Title],
                    [t.pdfStep1Desc, t.pdfStep2Desc, t.pdfStep3Desc]
                ],
                styles: { fontSize: 9, cellPadding: 3 },
                headStyles: { fontStyle: 'bold', fillColor: [243, 244, 246], textColor: [55, 65, 81] },
                bodyStyles: {textColor: [107, 114, 128] }
            });
            
            // Footer (sin cambios, ya usa las constantes)
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8).setTextColor(156, 163, 175);
                doc.text(t.pdfFooter, doc.internal.pageSize.width / 2, 290, { align: 'center' });
            }

            doc.save(`Presupuesto Lupa Editions - ${clientName}.pdf`);
        };
        
        // --- EVENT LISTENERS (SIN CAMBIOS) ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            calcularYMostrarPresupuesto();
        });

        btnGenerarPDF.addEventListener('click', generarPDF);
        tipoProyecto.addEventListener('change', updateFormVisibility);
        btnLangEs.addEventListener('click', () => setLanguage('es'));
        btnLangEn.addEventListener('click', () => setLanguage('en'));

        // --- INICIALIZACI√ìN (SIN CAMBIOS) ---
        updateFormVisibility();
        setLanguage(currentLanguage);
    });
    </script>
</body>
</html>
