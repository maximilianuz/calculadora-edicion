<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lupa Editions | Calculadora Interna de Presupuestos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-color: #f9fafb; --text-color: #111827; --card-bg: #ffffff;
            --border-color: #d1d5db; --primary-color: #3b82f6; --primary-hover: #2563eb;
            --label-color: #374151; --header-color: #1f2937; --subtle-text: #6b7280;
            --success-bg: #dcfce7; --success-text: #166534; --info-bg: #e0f2fe;
            --info-text: #075985;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827; --text-color: #f9fafb; --card-bg: #1f2937;
                --border-color: #4b5563; --primary-color: #60a5fa; --primary-hover: #3b82f6;
                --label-color: #d1d5db; --header-color: #f9fafb; --subtle-text: #9ca3af;
                --success-bg: #14532d; --success-text: #dcfce7; --info-bg: #0c4a6e;
                --info-text: #e0f2fe;
            }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0 auto; padding: 2rem; background-color: var(--bg-color);
            color: var(--text-color); max-width: 900px;
        }
        header { text-align: center; margin-bottom: 2rem; }
        #logo-container {
            margin-bottom: 1rem; cursor: pointer; border: 2px dashed var(--border-color);
            border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 100px;
        }
        #logo-preview { max-width: 150px; max-height: 80px; margin-bottom: 0.5rem; }
        #logo-placeholder { color: var(--subtle-text); }
        input[type="file"] { display: none; }
        h1, h2 { color: var(--header-color); text-align: center; }
        form, #resultado-container, #historial-container {
            background-color: var(--card-bg); padding: 2rem; border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin-bottom: 2rem;
        }
        fieldset { border: none; padding: 0; margin-bottom: 1.5rem; }
        legend { font-size: 1.25rem; font-weight: 600; color: var(--header-color); margin-bottom: 1rem; }
        label { font-weight: 600; display: block; margin: 1rem 0 0.5rem; color: var(--label-color); }
        input[type="text"], input[type="number"], input[type="date"], select, textarea {
            width: 100%; padding: 0.75rem; border: 1px solid var(--border-color);
            border-radius: 8px; font-size: 1rem; background-color: var(--bg-color);
            color: var(--text-color); box-sizing: border-box;
        }
        .button-group { display: flex; gap: 1rem; margin-top: 1.5rem; }
        button {
            background-color: var(--primary-color); color: white; border: none;
            border-radius: 8px; padding: 0.8rem 1.5rem; font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; flex-grow: 1;
        }
        button:hover { background-color: var(--primary-hover); }
        #btnGenerarPDF { background-color: var(--success-bg); color: var(--success-text); }
        #btnGenerarPDF:hover { background-color: color-mix(in srgb, var(--success-bg) 80%, black); }
        #resultado { background-color: var(--info-bg); color: var(--info-text); padding: 1.5rem; border-radius: 8px; }
        #resultado h3 { margin-top: 0; }
        #resultado ul { list-style: none; padding: 0; }
        #resultado ul li { margin-bottom: 0.5rem; }
        #resultado-total { font-size: 1.5rem; font-weight: bold; text-align: center; margin-top: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { border: 1px solid var(--border-color); padding: 0.6rem; text-align: left; }
    </style>
</head>
<body>
    <header>
        <label for="logoUpload" id="logo-container">
            <img id="logo-preview" src="" alt="Previsualizaci√≥n del Logo" style="display:none;">
            <span id="logo-placeholder">Haz clic aqu√≠ para subir tu logo</span>
        </label>
        <input type="file" id="logoUpload" accept="image/*">
        
        <h1>Lupa Editions | Calculadora Interna</h1>
        <p style="color:var(--subtle-text); font-style: italic;">"El detalle no adorna, comunica."</p>
    </header>

    <form id="presupuestoForm" autocomplete="off">
        <fieldset>
            <legend>1. Informaci√≥n General</legend>
            <label for="nombreCliente">Nombre del Cliente/Proyecto</label>
            <input type="text" id="nombreCliente" placeholder="Ej: Marca Creativa - Video Lanzamiento" required>
            <label for="objetivo">Objetivo del video</label>
            <select id="objetivo" required>
                <option value="Promocional">Promocional / Publicidad</option>
                <option value="Educativo">Educativo / Tutorial</option>
                <option value="Redes sociales">Contenido para Redes Sociales</option>
                <option value="Corporativo">Corporativo / Interno</option>
                <option value="Documental">Documental / Entrevista</option>
                <option value="Emocional">Boda / Evento Emocional</option>
            </select>
            <label for="referenciaEstilo">Referencia de estilo</label>
            <textarea id="referenciaEstilo" placeholder="Link de YouTube o descripci√≥n del estilo deseado..." rows="2"></textarea>
        </fieldset>

        <fieldset>
            <legend>2. Material y Complejidad T√©cnica</legend>
            <label for="duracionBruto">Duraci√≥n del material en bruto (minutos)</label>
            <input type="number" id="duracionBruto" min="0" placeholder="Aprox. total de minutos grabados" required>
            <label for="organizacionMaterial">Estado del material</label>
            <select id="organizacionMaterial" required>
                <option value="organizado">Organizado y pre-seleccionado</option>
                <option value="desorganizado">En bruto, requiere limpieza y selecci√≥n</option>
            </select>
            <label for="multicamara">Edici√≥n Multic√°mara</label>
            <select id="multicamara" required>
                <option value="No">No</option>
                <option value="Si">S√≠ (sincronizaci√≥n necesaria)</option>
            </select>
        </fieldset>

        <fieldset>
            <legend>3. Post-Producci√≥n y Extras</legend>
            <label for="tipoEdicion">Nivel de Dinamismo de la Edici√≥n</label>
            <select id="tipoEdicion" required>
                <option value="Basica">B√°sica (cortes simples)</option>
                <option value="Dinamica">Din√°mica (muchos cortes, ritmo r√°pido)</option>
                <option value="Cinematografica">Cinematogr√°fica (narrativa visual)</option>
            </select>
            <label for="efectos">Gr√°ficos y Efectos</label>
            <select id="efectos" required>
                <option value="No">Sin efectos ni gr√°ficos</option>
                <option value="Simples">Gr√°ficos simples (z√≥calos, t√≠tulos)</option>
                <option value="Avanzados">Motion Graphics / Animaci√≥n 2D</option>
            </select>
            <label for="subtitulos">Subt√≠tulos</label>
            <select id="subtitulos" required>
                <option value="No">No</option>
                <option value="Automaticos">Autom√°ticos (con revisi√≥n)</option>
                <option value="Personalizados">Personalizados y animados</option>
            </select>
             <label for="musica">M√∫sica y Sonido</label>
            <select id="musica" required>
                <option value="Proporcionada">Proporcionada por cliente</option>
                <option value="Libreria">B√∫squeda en librer√≠a de stock</option>
                <option value="Diseno">Dise√±o de sonido / Mezcla avanzada</option>
            </select>
        </fieldset>
        
        <fieldset>
            <legend>4. Entregables y Plazos</legend>
            <label for="duracionFinal">Duraci√≥n final del video (minutos)</label>
            <input type="number" id="duracionFinal" min="1" required value="3">
            <label for="versiones">Cantidad de formatos/versiones</label>
            <input type="number" id="versiones" min="1" value="1" required placeholder="Ej: 16:9, 9:16, 1:1">
            <label for="revisiones">Rondas de revisi√≥n incluidas</label>
            <input type="number" id="revisiones" min="0" value="2" required>
             <label for="urgencia">Nivel de Urgencia</label>
            <select id="urgencia" required>
                <option value="Normal">Normal ( > 1 semana)</option>
                <option value="Moderada">Moderada (3-7 d√≠as)</option>
                <option value="Alta">Alta ( < 48 horas)</option>
            </select>
        </fieldset>

        <fieldset>
            <legend>5. Par√°metros de Costo</legend>
            <label for="tarifaHora">Tu Tarifa por Hora (USD)</label>
            <input type="number"id="tarifaHora" min="1" value="40" required>
        </fieldset>

        <div class="button-group">
            <button type="submit">Calcular Estimaci√≥n Interna</button>
            <button type="button" id="btnGenerarPDF" disabled>Generar PDF para Cliente</button>
        </div>
    </form>

    <div id="resultado-container" style="display:none;">
        <h2>üìä Resumen de Estimaci√≥n</h2>
        <div id="resultado"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const { jsPDF } = window.jspdf;
        const form = document.getElementById('presupuestoForm');
        const resultadoContainer = document.getElementById('resultado-container');
        const resultadoDiv = document.getElementById('resultado');
        const btnGenerarPDF = document.getElementById('btnGenerarPDF');
        
        const logoUpload = document.getElementById('logoUpload');
        const logoContainer = document.getElementById('logo-container');
        const logoPreview = document.getElementById('logo-preview');
        const logoPlaceholder = document.getElementById('logo-placeholder');
        
        let currentQuoteData = {};
        let logoBase64 = localStorage.getItem('lupaEditionsLogo') || null;

        // --- GESTI√ìN DEL LOGO ---
        if (logoBase64) {
            logoPreview.src = logoBase64;
            logoPreview.style.display = 'block';
            logoPlaceholder.style.display = 'none';
        }

        logoContainer.addEventListener('click', () => logoUpload.click());
        logoUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoBase64 = e.target.result;
                    logoPreview.src = logoBase64;
                    localStorage.setItem('lupaEditionsLogo', logoBase64);
                    logoPreview.style.display = 'block';
                    logoPlaceholder.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        // --- L√ìGICA DE C√ÅLCULO ---
        const factores = {
            organizacion: { desorganizado: 1.4, organizado: 1.0 }, // Multiplicador
            multicamara: { Si: 5, No: 0 }, // Horas
            tipoEdicion: { Basica: 0.5, Dinamica: 1.0, Cinematografica: 1.8 }, // Multiplicador
            efectos: { No: 0, Simples: 4, Avanzados: 12 }, // Horas
            subtitulos: { No: 0, Automaticos: 1.5, Personalizados: 3 }, // Horas
            musica: { Proporcionada: 0, Libreria: 1, Diseno: 4 }, // Horas
            revisiones: 1.5, // Horas por ronda
            versiones: 1, // Horas por versi√≥n extra
            urgencia: { Normal: 1.0, Moderada: 1.25, Alta: 1.75 } // Multiplicador
        };

        function calcularHoras(data) {
            let desglose = { base: 0, complejidad: 0, extras: 0 };
            
            // 1. Horas base por visionado y selecci√≥n
            // Ratio: por cada 10 min de bruto, se invierte X tiempo.
            let ratioSeleccion = data.tipoEdicion === 'Cinematografica' ? 0.4 : 0.2;
            desglose.base = data.duracionBruto * ratioSeleccion;
            desglose.base *= factores.organizacion[data.organizacionMaterial];

            // 2. Horas de edici√≥n por minuto final
            let horasPorMinutoFinal = 2; // Base para edici√≥n simple
            horasPorMinutoFinal *= factores.tipoEdicion[data.tipoEdicion];
            desglose.base += data.duracionFinal * horasPorMinutoFinal;

            // 3. Sumar horas por complejidad y extras
            desglose.complejidad += factores.multicamara[data.multicamara];
            desglose.extras += factores.efectos[data.efectos];
            desglose.extras += factores.subtitulos[data.subtitulos];
            desglose.extras += factores.musica[data.musica];
            desglose.extras += data.revisiones * factores.revisiones;
            desglose.extras += (data.versiones - 1) * factores.versiones;

            let horasTotales = desglose.base + desglose.complejidad + desglose.extras;
            
            // 4. Aplicar multiplicador de urgencia
            let horasFinales = horasTotales * factores.urgencia[data.urgencia];
            
            return {
                total: horasFinales,
                desglose: {
                    "Visionado y Selecci√≥n": desglose.base,
                    "Complejidad T√©cnica": desglose.complejidad,
                    "Extras y Post": desglose.extras
                },
                urgencyFactor: factores.urgencia[data.urgencia]
            };
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Convertir a n√∫meros
            data.duracionBruto = Number(data.duracionBruto);
            data.duracionFinal = Number(data.duracionFinal);
            data.versiones = Number(data.versiones);
            data.revisiones = Number(data.revisiones);
            data.tarifaHora = Number(data.tarifaHora);
            
            const calculo = calcularHoras(data);
            const precioEstimado = calculo.total * data.tarifaHora;

            resultadoContainer.style.display = 'block';
            let desgloseHTML = '<ul>';
            for (const [key, value] of Object.entries(calculo.desglose)) {
                if(value > 0) desgloseHTML += `<li>${key}: ${value.toFixed(1)} hrs</li>`;
            }
            if (calculo.urgencyFactor > 1.0) {
                 desgloseHTML += `<li><strong>Multiplicador Urgencia:</strong> x${calculo.urgencyFactor}</li>`;
            }
            desgloseHTML += '</ul>';

            resultadoDiv.innerHTML = `
                <h3>Desglose de Horas</h3>
                ${desgloseHTML}
                <hr>
                <p><strong>Horas Totales Estimadas:</strong> ${calculo.total.toFixed(1)} hrs</p>
                <div id="resultado-total">
                    Precio Sugerido: $${precioEstimado.toFixed(2)} USD
                </div>
            `;
            
            currentQuoteData = { ...data, precio: precioEstimado, duracion: data.duracionFinal };
            btnGenerarPDF.disabled = false;
            
            window.scrollTo({ top: resultadoContainer.offsetTop - 20, behavior: 'smooth' });
        });
        
        // --- GENERACI√ìN DE PDF ---
        btnGenerarPDF.addEventListener('click', () => {
            if (!currentQuoteData.nombreCliente) {
                alert("Por favor, calcula un presupuesto primero.");
                return;
            }
            
            const doc = new jsPDF();
            const fechaHoy = new Date();
            const fechaLimite = new Date(fechaHoy.getTime() + 7 * 24 * 60 * 60 * 1000);

            if (logoBase64) {
                 doc.addImage(logoBase64, 'JPEG', 15, 15, 30, 30);
            }

            doc.setFontSize(24); doc.setFont("helvetica", "bold");
            doc.text("Lupa Editions", 50, 28);
            doc.setFontSize(12); doc.setFont("helvetica", "italic");
            doc.text("El detalle no adorna, comunica.", 50, 36);
            doc.setLineWidth(0.5); doc.line(15, 45, 195, 45);

            doc.setFontSize(18); doc.setFont("helvetica", "bold");
            doc.text("Propuesta de Edici√≥n de Video", 105, 60, { align: 'center' });
            
            doc.setFontSize(11); doc.setFont("helvetica", "normal");
            doc.text(`Proyecto: ${currentQuoteData.nombreCliente}`, 15, 75);
            doc.text(`Fecha: ${fechaHoy.toLocaleDateString('es-AR')}`, 15, 82);
            doc.text(`Validez de la oferta: 7 d√≠as (hasta ${fechaLimite.toLocaleDateString('es-AR')})`, 150, 82, {align: 'right'});

            doc.setFontSize(14); doc.setFont("helvetica", "bold");
            doc.text("Alcance del Proyecto:", 15, 100);
            
            const clientInfo = [
                `- Objetivo: ${currentQuoteData.objetivo}`,
                `- Duraci√≥n Estimada: ${currentQuoteData.duracion} minutos.`,
                `- Entregables: ${currentQuoteData.versiones} versi√≥n(es) final(es).`,
                `- Rondas de Revisi√≥n: ${currentQuoteData.revisiones} incluidas.`,
                `- Elementos Incluidos: Edici√≥n ${currentQuoteData.tipoEdicion}, ${currentQuoteData.efectos !== 'No' ? 'gr√°ficos/efectos, ' : ''}${currentQuoteData.subtitulos !== 'No' ? 'subt√≠tulos, ' : ''}b√∫squeda de m√∫sica.`,
            ];
            doc.setFontSize(12); doc.setFont("helvetica", "normal");
            doc.text(clientInfo, 20, 110, { lineHeightFactor: 1.5 });
            
            doc.setFontSize(16); doc.setFont("helvetica", "bold");
            doc.text("Inversi√≥n Total del Proyecto:", 15, 160);
            doc.setFontSize(22);
            doc.text(`$${currentQuoteData.precio.toFixed(2)} USD`, 20, 170);

            doc.setFontSize(10); doc.setFont("helvetica", "bold");
            doc.text("T√©rminos y Condiciones:", 15, 200);
            doc.setFont("helvetica", "normal");
            const terms = `1. Pago: 50% por adelantado para iniciar el proyecto, 50% a la entrega final.\n2. Revisiones: Rondas de revisi√≥n adicionales se facturar√°n a $${currentQuoteData.tarifaHora}/hr.\n3. Materiales: El cliente proveer√° todo el material audiovisual base ( ‡§´‡•Å‡§ü‡•á‡§ú ).\n4. Entrega: El video final se entregar√° en formato digital (MP4 H.264) a menos que se especifique lo contrario.`;
            doc.text(terms, 15, 207, { maxWidth: 180, lineHeightFactor: 1.5 });
            
            doc.setFontSize(12); doc.setFont("helvetica", "italic");
            doc.text("¬°Estamos listos para dar vida a tu visi√≥n!", 105, 250, { align: 'center' });

            doc.save(`Propuesta_LupaEditions_${currentQuoteData.nombreCliente.replace(/\s/g, '_')}.pdf`);
        });
    });
    </script>
</body>
</html>
