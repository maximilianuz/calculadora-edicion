<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lupa Editions | Calculadora H√≠brida de Presupuestos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --bg-color: #f9fafb; --text-color: #111827; --card-bg: #ffffff;
            --border-color: #d1d5db; --primary-color: #3b82f6; --primary-hover: #2563eb;
            --label-color: #374151; --header-color: #1f2937; --subtle-text: #6b7280;
            --success-bg: #10b981; --success-text: #ffffff; --info-bg: #e0f2fe;
            --info-text: #075985;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827; --text-color: #f9fafb; --card-bg: #1f2937;
                --border-color: #4b5563; --primary-color: #60a5fa; --primary-hover: #3b82f6;
                --label-color: #d1d5db; --header-color: #f9fafb; --subtle-text: #9ca3af;
                --success-bg: #10b981; --success-text: #ffffff; --info-bg: #0c4a6e;
                --info-text: #e0f2fe;
            }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0 auto; padding: 2rem; background-color: var(--bg-color); color: var(--text-color); max-width: 900px; }
        header { text-align: center; margin-bottom: 2rem; }
        #company-logo { max-width: 220px; height: auto; margin-bottom: 1rem; border-radius: 8px; }
        h1, h2, h3 { color: var(--header-color); text-align: center; }
        form, #resultado-container { background-color: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-bottom: 2rem; }
        fieldset { border: 1px solid var(--border-color); padding: 1.5rem; margin: 0 0 1.5rem 0; border-radius: 8px; }
        legend { font-size: 1.25rem; font-weight: 600; color: var(--header-color); padding: 0 0.5rem; margin-left: 1rem; }
        label { font-weight: 600; display: block; margin: 1rem 0 0.5rem; color: var(--label-color); }
        input, select, textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; background-color: var(--bg-color); color: var(--text-color); box-sizing: border-box; transition: border-color 0.3s, box-shadow 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent); }
        .input-group { display: flex; gap: 1rem; align-items: center; margin-top: 1rem; }
        .input-group label { margin: 0; font-weight: normal; }
        .input-group input[type="checkbox"] { width: auto; }
        .button-group { display: flex; gap: 1rem; margin-top: 1.5rem; }
        button { background-color: var(--primary-color); color: white; border: none; border-radius: 8px; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; flex-grow: 1; }
        button:hover { background-color: var(--primary-hover); }
        button:active { transform: scale(0.98); }
        #btnGenerarPDF { background-color: var(--success-bg); color: var(--success-text); }
        #btnGenerarPDF:hover { background-color: color-mix(in srgb, var(--success-bg) 85%, black); }
        button:disabled { background-color: var(--border-color); cursor: not-allowed; }
        #resultado { background-color: var(--info-bg); color: var(--info-text); padding: 1.5rem; border-radius: 8px; }
        #resultado h3 { margin-top: 0; color: var(--header-color);}
        #resultado p strong { color: var(--header-color); }
        #resultado ul { list-style-type: '‚úì'; padding-left: 20px; }
        #resultado li { margin-bottom: 0.5rem; }
        #resultado-total { font-size: 1.5rem; font-weight: bold; text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid color-mix(in srgb, var(--info-text) 25%, transparent);}
        .hidden { display: none; }
        .campo-dinamico {
            padding-left: 1.5rem;
            border-left: 3px solid var(--primary-color);
            margin-top: 1rem;
            padding-top: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <img id="company-logo" src="https://i.postimg.cc/t7Tfd4Wy/LOGO-FINAL.jpg" alt="Lupa Editions Logo"/>
        <h1>Lupa Editions | Calculadora H√≠brida</h1>
        <p style="color:var(--subtle-text); font-style: italic;">Presupuestos por paquete y por horas.</p>
    </header>

    <form id="presupuestoForm" autocomplete="off" novalidate>
        <fieldset>
            <legend>Tipo de Presupuesto</legend>
            <label for="tipoProyecto">Selecciona el modelo de c√°lculo</label>
            <select id="tipoProyecto" required>
                <option value="detallado" selected>Por Horas (Detallado y Preciso)</option>
                <option value="reels">Por Paquete (Reels / TikToks)</option>
                <option value="corporativo">Por Paquete (Videos Corporativos)</option>
                <option value="cursos">Por Paquete (Cursos o Formaciones)</option>
                <option value="motion">Por Paquete (Motion Graphics / AE)</option>
                <option value="vsl">Por Paquete (VSL - Video Sales Letter)</option>
            </select>
        </fieldset>
        
        <div id="container-por-proyecto" class="hidden">
            <fieldset>
                <legend>Detalles del Proyecto</legend>
                <label for="nombreClienteProyecto">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteProyecto" placeholder="Ej: Marca Creativa - Campa√±a Reels Q3">
                
                <div id="campo-duracion-cursos" class="hidden">
                    <label for="duracionFinalCursos">Duraci√≥n final total (minutos)</label>
                    <input type="number" id="duracionFinalCursos" min="1" value="10">
                </div>
            </fieldset>
            <fieldset>
                <legend>Caracter√≠sticas Adicionales</legend>
                <p style="color:var(--subtle-text); font-size: 0.9rem; margin-top: -1rem; margin-bottom: 1rem;">Cada opci√≥n seleccionada ajustar√° el precio autom√°ticamente.</p>
                <div class="input-group">
                    <input type="checkbox" id="paquete_graficos">
                    <label for="paquete_graficos">Gr√°ficos y T√≠tulos Animados</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_color">
                    <label for="paquete_color">Correcci√≥n de Color Avanzada</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="paquete_musica">
                    <label for="paquete_musica">B√∫squeda de M√∫sica de Librer√≠a</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_formatos">
                    <label for="paquete_formatos">M√∫ltiples Formatos (ej. vertical y horizontal)</label>
                </div>
            </fieldset>
        </div>

        <div id="container-detallado">
            <fieldset>
                <legend>üß† 1. Contexto General</legend>
                <label for="nombreClienteDetallado">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteDetallado" placeholder="Ej: Video Promocional para Web" required>
                <label for="objetivo">Objetivo del video y d√≥nde se publicar√°</label>
                <textarea id="objetivo" rows="3" placeholder="Ej: Video promocional para la home de la web y campa√±a de redes sociales (Instagram, YouTube)."></textarea>
            </fieldset>

            <fieldset>
                <legend>üì¶ 2. Material a Editar</legend>
                <label for="duracionBruto">Duraci√≥n total aproximada del material en bruto (minutos)</label>
                <input type="number" id="duracionBruto" min="0" value="30" required>
                <label for="organizacionMaterial">Organizaci√≥n del material</label>
                <select id="organizacionMaterial">
                    <option value="organizado">Organizado (pre-seleccionado y clasificado)</option>
                    <option value="desorganizado" selected>Desorganizado (hay que seleccionar y limpiar)</option>
                </select>
            </fieldset>
            
            <fieldset>
                <legend>‚úÇÔ∏è 3. Tipo de Edici√≥n</legend>
                <label for="tipoEdicion">Estilo principal de edici√≥n</label>
                <select id="tipoEdicion">
                    <option value="rapida_redes">R√°pida para Redes (Din√°mica, con zooms, subt√≠tulos virales)</option>
                    <option value="corporativa" selected>Corporativa / Documental (Clara, profesional, ritmo pausado)</option>
                    <option value="emocional">Emocional / Cinematogr√°fica (Correcci√≥n de color avanzada, sound design)</option>
                </select>
                 <div class="input-group">
                    <input type="checkbox" id="multicam">
                    <label for="multicam">¬øSe necesita edici√≥n multic√°mara?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="motionGraphics">
                    <label for="motionGraphics">¬øIncluir√° Motion Graphics / Animaci√≥n (After Effects)?</label>
                </div>
                <div id="campo-complejidad-motion" class="hidden campo-dinamico">
                     <label for="complejidadMotion">Complejidad de los Motion Graphics</label>
                     <select id="complejidadMotion">
                         <option value="baja">Baja (T√≠tulos, tercios inferiores animados)</option>
                         <option value="media">Media (Animaci√≥n de logos, transiciones personalizadas)</option>
                         <option value="alta">Alta (Explicaciones animadas complejas, tracking, VFX)</option>
                     </select>
                </div>
            </fieldset>
            
            <fieldset>
                <legend>üî† 4. Elementos Extra</legend>
                <label for="subtitulos">Subt√≠tulos</label>
                <select id="subtitulos">
                    <option value="no">No necesarios</option>
                    <option value="automaticos">Autom√°ticos (con revisi√≥n)</option>
                    <option value="personalizados">Personalizados (animados, estilo de marca)</option>
                </select>
                <div class="input-group">
                    <input type="checkbox" id="busquedaMusica">
                    <label for="busquedaMusica">¬øNecesita b√∫squeda y licenciamiento de m√∫sica?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="voiceOver">
                    <label for="voiceOver">¬øSe necesita grabaci√≥n y edici√≥n de Voice-over?</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="disenoMiniatura">
                    <label for="disenoMiniatura">¬øNecesita dise√±o de miniatura/car√°tula (Thumbnail)?</label>
                </div>
            </fieldset>

            <fieldset>
                <legend>üìè 5. Entregables y Plazos</legend>
                <label for="duracionFinal">Duraci√≥n final estimada del video principal (minutos)</label>
                <input type="number" id="duracionFinal" min="1" value="2" required>
                <label for="versionesAdicionales">¬øCu√°ntas versiones adicionales se necesitan?</label>
                <input type="number" id="versionesAdicionales" min="0" value="1" placeholder="Ej: 1 (para formato vertical)">
                 <label for="plazoEntrega">Plazo de entrega</label>
                <select id="plazoEntrega">
                    <option value="normal">Normal (M√°s de 1 semana)</option>
                    <option value="urgente">Urgente (3-7 d√≠as)</option>
                    <option value="muy_urgente">Muy Urgente (Menos de 72 horas)</option>
                </select>
                 <label for="rondasRevision">Rondas de cambios incluidas</label>
                <input type="number"id="rondasRevision" min="0" value="2">
            </fieldset>
        </div>
        
        <fieldset>
             <legend>üíµ Par√°metros de Costo</legend>
             <div id="campo-tarifa-hora">
                <label for="tarifaHora">Tu Tarifa por Hora</label>
                <input type="number" id="tarifaHora" min="1" value="40">
             </div>
             <label for="moneda">Moneda del Presupuesto</label>
             <input type="text" id="moneda" value="USD" placeholder="Ej: USD, ARS, EUR" required>
        </fieldset>

        <div class="button-group">
            <button type="submit">Calcular Presupuesto</button>
            <button type="button" id="btnGenerarPDF" disabled>Generar PDF para Cliente</button>
        </div>
    </form>

    <div id="resultado-container" class="hidden">
        <h2>üìä Resumen del Presupuesto</h2>
        <div id="resultado"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ELEMENTOS DEL DOM ---
        const form = document.getElementById('presupuestoForm');
        const tipoProyectoSelect = document.getElementById('tipoProyecto');
        const containerDetallado = document.getElementById('container-detallado');
        const containerPorProyecto = document.getElementById('container-por-proyecto');
        const campoDuracionCursos = document.getElementById('campo-duracion-cursos');
        const campoTarifaHora = document.getElementById('campo-tarifa-hora');
        const resultadoContainer = document.getElementById('resultado-container');
        const resultadoDiv = document.getElementById('resultado');
        const btnGenerarPDF = document.getElementById('btnGenerarPDF');
        
        const motionGraphicsCheckbox = document.getElementById('motionGraphics');
        const campoComplejidadMotion = document.getElementById('campo-complejidad-motion');

        let currentQuoteData = {};

        // --- PRECIOS BASE POR TIPO DE PROYECTO (PAQUETES) ---
        const preciosPorProyecto = {
            'reels':       { min: 30,  max: 150, unidad: 'por video',           nombre: 'Reels/TikToks' },
            'corporativo': { min: 250, max: 800, unidad: 'por entrega',         nombre: 'Video Corporativo' },
            'cursos':      { min: 30,  max: 80,  unidad: 'por minuto final',    nombre: 'Curso/Formaci√≥n' },
            'motion':      { min: 300, max: 1500,unidad: 'seg√∫n complejidad',   nombre: 'Motion Graphics/AE' },
            'vsl':         { min: 200, max: 1000,unidad: 'seg√∫n guion y ritmo', nombre: 'VSL (Video Sales Letter)' }
        };

        // --- L√ìGICA DE VISUALIZACI√ìN DEL FORMULARIO ---
        tipoProyectoSelect.addEventListener('change', (e) => {
            const tipo = e.target.value;
            const esDetallado = tipo === 'detallado';

            containerDetallado.classList.toggle('hidden', !esDetallado);
            containerPorProyecto.classList.toggle('hidden', esDetallado);
            campoTarifaHora.classList.toggle('hidden', !esDetallado);

            // SOLUCI√ìN AL BUG: Alternar qu√© campos son requeridos
            containerDetallado.querySelectorAll('input, select, textarea').forEach(el => el.required = esDetallado);
            document.getElementById('nombreClienteProyecto').required = !esDetallado;
            document.getElementById('tarifaHora').required = esDetallado;
            
            // Caso especial: El campo de duraci√≥n de cursos solo es requerido si esa opci√≥n est√° visible
            document.getElementById('duracionFinalCursos').required = (tipo === 'cursos');
            campoDuracionCursos.classList.toggle('hidden', tipo !== 'cursos');
        });

        motionGraphicsCheckbox.addEventListener('change', (e) => {
            campoComplejidadMotion.classList.toggle('hidden', !e.target.checked);
        });

        // --- L√ìGICA DE C√ÅLCULO DETALLADO (POR HORAS) ---
        function calcularHoras(data) {
            const desglose = {};
            let totalHoras = 0;

            let horasClasificacion = data.duracionBruto * 0.15;
            if (data.organizacionMaterial === 'desorganizado') {
                horasClasificacion *= 1.5;
            }
            desglose['Clasificaci√≥n y Selecci√≥n de Material'] = horasClasificacion;
            totalHoras += horasClasificacion;

            let horasEdicion = data.duracionFinal * 1.5;
            const multiplicadoresEdicion = { 'rapida_redes': 1.2, 'corporativa': 1.0, 'emocional': 1.6 };
            horasEdicion *= multiplicadoresEdicion[data.tipoEdicion];
             if (data.multicam) {
                horasEdicion *= 1.4;
            }
            desglose['Edici√≥n Principal y Estructura'] = horasEdicion;
            totalHoras += horasEdicion;

            if (data.motionGraphics) {
                const horasPorComplejidad = { 'baja': 2.0, 'media': 5.0, 'alta': 10.0 };
                const horasMotion = horasPorComplejidad[data.complejidadMotion] * (1 + (data.duracionFinal - 1) * 0.2);
                desglose['Motion Graphics (AE)'] = horasMotion;
                totalHoras += horasMotion;
            }

            let horasExtras = 0;
            if (data.subtitulos === 'automaticos') horasExtras += data.duracionFinal * 0.1;
            else if (data.subtitulos === 'personalizados') horasExtras += data.duracionFinal * 0.3;
            if (data.busquedaMusica) horasExtras += 1;
            if (data.voiceOver) horasExtras += 1.5;
            if (data.disenoMiniatura) horasExtras += 1;
            
            horasExtras += (horasEdicion * 0.25) * data.versionesAdicionales;
            desglose['Post-Producci√≥n y Extras'] = horasExtras;
            totalHoras += horasExtras;
            
            const horasRevision = totalHoras * 0.15 * data.rondasRevision;
            desglose['Rondas de Revisi√≥n y Comunicaci√≥n'] = horasRevision;
            totalHoras += horasRevision;

            const factoresUrgencia = { 'normal': 1.0, 'urgente': 1.25, 'muy_urgente': 1.5 };
            const urgencyFactor = factoresUrgencia[data.plazoEntrega];
            let urgencyText = "Normal";
            if (urgencyFactor > 1.0) {
                 totalHoras *= urgencyFactor;
                 urgencyText = data.plazoEntrega.replace('_', ' ').charAt(0).toUpperCase() + data.plazoEntrega.replace('_', ' ').slice(1);
            }

            return { total: totalHoras, desglose: desglose, urgencyFactor: urgencyFactor, urgencyText: urgencyText };
        }

        // --- L√ìGICA DE C√ÅLCULO (EVENTO SUBMIT) ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const tipoProyecto = tipoProyectoSelect.value;
            const moneda = document.getElementById('moneda').value;
            let precioFinal = 0;
            let resultadoHTML = '';
            
            // --- MODELO DE PRECIOS POR PAQUETE (AUTOM√ÅTICO) ---
            if (tipoProyecto !== 'detallado') {
                const proyecto = preciosPorProyecto[tipoProyecto];
                const nombreCliente = document.getElementById('nombreClienteProyecto').value;
                const precioBase = proyecto.min;
                const rangoDePrecio = proyecto.max - proyecto.min;

                const features = {
                    "Gr√°ficos y T√≠tulos Animados": document.getElementById('paquete_graficos').checked,
                    "Correcci√≥n de Color Avanzada": document.getElementById('paquete_color').checked,
                    "B√∫squeda de M√∫sica de Librer√≠a": document.getElementById('paquete_musica').checked,
                    "M√∫ltiples Formatos": document.getElementById('paquete_formatos').checked
                };

                const featuresSeleccionadas = Object.keys(features).filter(f => features[f]);
                const numTotalFeatures = Object.keys(features).length;
                const precioPorFeature = rangoDePrecio / numTotalFeatures;

                const costoAdicional = precioPorFeature * featuresSeleccionadas.length;
                precioFinal = precioBase + costoAdicional;
                
                if (tipoProyecto === 'cursos') {
                    const duracion = Number(document.getElementById('duracionFinalCursos').value);
                    precioFinal *= duracion;
                }
                
                resultadoHTML = `<h3>${proyecto.nombre}</h3>
                    <p><strong>Precio Base:</strong> ${precioBase.toLocaleString('es-AR', { style: 'currency', currency: moneda })}</p>`;

                if (featuresSeleccionadas.length > 0) {
                     resultadoHTML += `<p><strong>Caracter√≠sticas Adicionales:</strong></p><ul>`;
                     featuresSeleccionadas.forEach(f => {
                         resultadoHTML += `<li>${f}</li>`;
                     });
                     resultadoHTML += `</ul>`;
                }
                
                currentQuoteData = {
                    modelo: 'proyecto',
                    nombreCliente: nombreCliente,
                    tipoProyectoNombre: proyecto.nombre,
                    precio: precioFinal,
                    moneda: moneda,
                    features: featuresSeleccionadas
                };

            // --- MODELO DE PRECIOS DETALLADO (POR HORAS) ---
            } else {
                const data = {
                    nombreCliente: document.getElementById('nombreClienteDetallado').value,
                    objetivo: document.getElementById('objetivo').value,
                    duracionBruto: Number(document.getElementById('duracionBruto').value),
                    organizacionMaterial: document.getElementById('organizacionMaterial').value,
                    tipoEdicion: document.getElementById('tipoEdicion').value,
                    multicam: document.getElementById('multicam').checked,
                    motionGraphics: document.getElementById('motionGraphics').checked,
                    complejidadMotion: document.getElementById('complejidadMotion').value,
                    subtitulos: document.getElementById('subtitulos').value,
                    busquedaMusica: document.getElementById('busquedaMusica').checked,
                    voiceOver: document.getElementById('voiceOver').checked,
                    disenoMiniatura: document.getElementById('disenoMiniatura').checked,
                    duracionFinal: Number(document.getElementById('duracionFinal').value),
                    versionesAdicionales: Number(document.getElementById('versionesAdicionales').value),
                    plazoEntrega: document.getElementById('plazoEntrega').value,
                    rondasRevision: Number(document.getElementById('rondasRevision').value),
                    tarifaHora: Number(document.getElementById('tarifaHora').value),
                    moneda: moneda
                };

                const calculo = calcularHoras(data);
                precioFinal = calculo.total * data.tarifaHora;
                
                let desgloseHTML = '<ul>';
                for (const [key, value] of Object.entries(calculo.desglose)) {
                    if(value > 0) desgloseHTML += `<li>${key}: <strong>${value.toFixed(1)} h</strong></li>`;
                }
                desgloseHTML += '</ul>';

                resultadoHTML = `
                    <h3>Desglose de Horas Estimadas</h3>
                    ${desgloseHTML}
                    <hr>
                    <p><strong>Horas Base Estimadas:</strong> ${Object.values(calculo.desglose).reduce((a, b) => a + b, 0).toFixed(1)} h</p>`;
                if (calculo.urgencyFactor > 1.0) {
                     resultadoHTML += `<p><strong>Multiplicador Urgencia (${calculo.urgencyText}):</strong> x${calculo.urgencyFactor}</p>`;
                }
                resultadoHTML +=`
                    <p><strong>Total Horas (con revisiones y urgencia):</strong> <strong>${calculo.total.toFixed(1)} h</strong></p>
                `;
                
                currentQuoteData = { modelo: 'detallado', ...data, precio: precioFinal, ...calculo };
            }

            // --- MOSTRAR RESULTADO ---
            resultadoDiv.innerHTML = `
                ${resultadoHTML}
                <div id="resultado-total">
                    Precio Final Estimado: ${precioFinal.toLocaleString('es-AR', { style: 'currency', currency: moneda, minimumFractionDigits: 2 })}
                </div>`;
            
            resultadoContainer.classList.remove('hidden');
            btnGenerarPDF.disabled = false;
            window.scrollTo({ top: resultadoContainer.offsetTop - 20, behavior: 'smooth' });
        });
        
        // --- GENERACI√ìN DE PDF ---
        btnGenerarPDF.addEventListener('click', () => {
             if (Object.keys(currentQuoteData).length === 0) {
                 alert("Por favor, calcula un presupuesto primero.");
                 return;
             }
             generarPDF(currentQuoteData);
        });

        function generarPDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            try {
                const imgData = document.getElementById('company-logo').src;
                doc.addImage(imgData, 'JPEG', 15, 10, 50, 0);
            } catch (e) {
                console.error("No se pudo cargar la imagen para el PDF:", e);
                doc.setFontSize(20);
                doc.text("Lupa Editions", 15, 20);
            }
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text("PROPUESTA DE EDICI√ìN DE VIDEO", 200, 20, null, null, 'right');
            doc.setFont('helvetica', 'normal');
            doc.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 200, 26, null, null, 'right');
            doc.text(`Cliente: ${data.nombreCliente || 'A confirmar'}`, 200, 32, null, null, 'right');
            
            let y = 55;
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text("Resumen del Proyecto y Alcance", 105, y, null, null, 'center');
            y += 10;
            
            let tableBody = [];
            const head = [['Concepto', 'Detalle']];

            if (data.modelo === 'proyecto') {
                tableBody = [
                    ['Tipo de Proyecto', data.tipoProyectoNombre],
                    ['Caracter√≠sticas Incluidas', data.features.length > 0 ? doc.splitTextToSize(data.features.join(', '), 120) : 'Edici√≥n est√°ndar'],
                ];
            } else { // Modelo detallado
                 tableBody = [
                    ['Objetivo Principal', doc.splitTextToSize(data.objetivo, 120)],
                    ['Estilo de Edici√≥n', data.tipoEdicion.replace('_',' ').replace(/\b\w/g, l => l.toUpperCase())],
                    ['Duraci√≥n Estimada Final', `${data.duracionFinal} min.`],
                    ['Material Bruto a Procesar', `${data.duracionBruto} min. (estado: ${data.organizacionMaterial})`],
                    ['Motion Graphics / AE', data.motionGraphics ? `S√≠ (${data.complejidadMotion})` : 'No'],
                    ['Subt√≠tulos', data.subtitulos.charAt(0).toUpperCase() + data.subtitulos.slice(1)],
                    ['Versiones Adicionales', data.versionesAdicionales.toString()],
                    ['Rondas de Revisi√≥n', data.rondasRevision.toString()],
                ];
            }

            doc.autoTable({
                head: head, body: tableBody, startY: y, theme: 'grid',
                headStyles: { fillColor: [22, 160, 133] },
                didDrawPage: (hookData) => { y = hookData.cursor.y; }
            });
            
            y = doc.autoTable.previous.finalY + 20;

            doc.setFontSize(16); doc.setFont('helvetica', 'bold'); doc.text("Inversi√≥n del Proyecto", 15, y);
            y += 8;
            doc.setFontSize(22); doc.setTextColor('#3b82f6'); doc.text(`${data.precio.toLocaleString('es-AR', { style: 'currency', currency: data.moneda, minimumFractionDigits: 2})}`, 15, y);
            y += 8;
            
            doc.setFontSize(10); doc.setFont('helvetica', 'normal'); doc.setTextColor(100);
            if (data.modelo === 'detallado') {
                 doc.text(`Basado en una estimaci√≥n de ${data.total.toFixed(1)} horas a una tarifa de ${data.tarifaHora.toFixed(2)} ${data.moneda}/hora.`, 15, y);
            } else {
                 doc.text(`Precio final para el proyecto "${data.tipoProyectoNombre}" con las caracter√≠sticas seleccionadas.`, 15, y);
            }
             y += 15;

            doc.setFontSize(12); doc.setFont('helvetica', 'bold'); doc.setTextColor(0); doc.text("T√©rminos y Condiciones", 15, y);
            y += 6;

            doc.setFontSize(9); doc.setFont('helvetica', 'normal');
            const terms = [
                'Este presupuesto es una estimaci√≥n y puede variar si los requisitos del proyecto cambian significativamente.',
                'Forma de pago: 50% por adelantado para iniciar el trabajo y 50% a la entrega del video final.',
                'El material adicional o rondas de revisi√≥n no contempladas se presupuestar√°n por separado.',
                'La propuesta es v√°lida por 30 d√≠as.'
            ];
            terms.forEach(term => { doc.text(`‚Ä¢ ${term}`, 15, y); y += 5; });
            
            const pageCount = doc.internal.getNumberOfPages();
            for(let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text(`Lupa Editions | Presupuesto | P√°gina ${i} de ${pageCount}`, 105, 290, null, null, 'center');
            }
            
            const safeFileName = (data.nombreCliente || 'proyecto').replace(/[\s\/]/g, '_');
            doc.save(`Propuesta_LupaEditions_${safeFileName}.pdf`);
        }
        
        // --- INICIALIZACI√ìN ---
        tipoProyectoSelect.dispatchEvent(new Event('change'));
    });
    </script>
</body>
</html>
