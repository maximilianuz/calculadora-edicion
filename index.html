<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate-key="pageTitle">Lupa Editions | Calculadora de Presupuestos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* --- ESTILOS (sin cambios, se mantienen los de la versi√≥n anterior) --- */
        :root {
            --bg-color: #f9fafb; --text-color: #111827; --card-bg: #ffffff;
            --border-color: #d1d5db; --primary-color: #3b82f6; --primary-hover: #2563eb;
            --label-color: #374151; --header-color: #1f2937; --subtle-text: #6b7280;
            --success-bg: #10b981; --success-text: #ffffff; --info-bg: #e0f2fe;
            --info-text: #075985;
            --danger-bg: #fee2e2; --danger-text: #991b1b;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827; --text-color: #f9fafb; --card-bg: #1f2937;
                --border-color: #4b5563; --primary-color: #60a5fa; --primary-hover: #3b82f6;
                --label-color: #d1d5db; --header-color: #f9fafb; --subtle-text: #9ca3af;
                --success-bg: #10b981; --success-text: #ffffff; --info-bg: #0c4a6e;
                --info-text: #e0f2fe;
                --danger-bg: #450a0a; --danger-text: #fecaca;
            }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0 auto; padding: 2rem; background-color: var(--bg-color); color: var(--text-color); max-width: 900px; }
        header { text-align: center; margin-bottom: 2rem; position: relative; }
        .lang-switcher { position: absolute; top: 0; right: 0; display: flex; gap: 0.5rem; }
        .lang-switcher button { background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 6px; padding: 0.4rem 0.6rem; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .lang-switcher button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        #company-logo { max-width: 220px; height: auto; margin-bottom: 1rem; border-radius: 8px; }
        h1, h2, h3 { color: var(--header-color); text-align: center; }
        form, #resultado-container { background-color: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-bottom: 2rem; }
        fieldset { border: 1px solid var(--border-color); padding: 1.5rem; margin: 0 0 1.5rem 0; border-radius: 8px; }
        legend { font-size: 1.25rem; font-weight: 600; color: var(--header-color); padding: 0 0.5rem; margin-left: 1rem; }
        label { font-weight: 600; display: block; margin: 1rem 0 0.5rem; color: var(--label-color); }
        input, select, textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; background-color: var(--bg-color); color: var(--text-color); box-sizing: border-box; transition: border-color 0.3s, box-shadow 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent); }
        .input-group { display: flex; gap: 1rem; align-items: center; margin-top: 1rem; }
        .input-group label { margin: 0; font-weight: normal; }
        .input-group input[type="checkbox"] { width: auto; }
        .button-group { display: flex; gap: 1rem; margin-top: 1.5rem; }
        button { background-color: var(--primary-color); color: white; border: none; border-radius: 8px; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; flex-grow: 1; }
        button:hover { background-color: var(--primary-hover); }
        button:active { transform: scale(0.98); }
        #btnGenerarPDF { background-color: var(--success-bg); color: var(--success-text); }
        #btnGenerarPDF:hover { background-color: color-mix(in srgb, var(--success-bg) 85%, black); }
        button:disabled { background-color: var(--border-color); cursor: not-allowed; }
        #resultado { background-color: var(--info-bg); color: var(--info-text); padding: 1.5rem; border-radius: 8px; }
        #resultado h3 { margin-top: 0; color: var(--header-color);}
        #resultado p strong { color: var(--header-color); }
        #resultado ul { list-style-type: '‚úì'; padding-left: 20px; }
        #resultado li { margin-bottom: 0.5rem; }
        .descuento { color: var(--danger-text); background-color: var(--danger-bg); padding: 0.2rem 0.5rem; border-radius: 6px; font-weight: bold; }
        #resultado-total { font-size: 1.5rem; font-weight: bold; text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid color-mix(in srgb, var(--info-text) 25%, transparent);}
        .hidden { display: none; }
        .campo-dinamico {
            padding-left: 1.5rem;
            border-left: 3px solid var(--primary-color);
            margin-top: 1rem;
            padding-top: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="lang-switcher">
            <button id="btn-lang-es" class="active">ES</button>
            <button id="btn-lang-en">EN</button>
        </div>
        <img id="company-logo" src="https://i.postimg.cc/t7Tfd4Wy/LOGO-FINAL.jpg" alt="Lupa Editions Logo"/>
        <h1 data-translate-key="mainHeader">Lupa Editions | Calculadora de Presupuestos</h1>
        <p style="color:var(--subtle-text);" data-translate-key="subHeader">Genera presupuestos profesionales y autom√°ticos.</p>
    </header>

    <form id="presupuestoForm" autocomplete="off" novalidate>
        <fieldset>
            <legend data-translate-key="calculationModel">Modelo de C√°lculo</legend>
            <label for="tipoProyecto" data-translate-key="selectProjectType">Selecciona el tipo de proyecto</label>
            <select id="tipoProyecto" required>
                <option value="detallado" selected data-translate-key="projectTypeDetailed">Proyecto Detallado (Precio Fijo Autom√°tico)</option>
                <option value="reels" data-translate-key="projectTypeReels">Paquete de Reels / TikToks</option>
                <option value="corporativo" data-translate-key="projectTypeCorporate">Paquete de Video Corporativo</option>
                <option value="cursos" data-translate-key="projectTypeCourses">Paquete de Cursos / Formaciones</option>
                <option value="motion" data-translate-key="projectTypeMotion">Paquete de Motion Graphics / AE</option>
                <option value="vsl" data-translate-key="projectTypeVSL">Paquete de VSL (Video Sales Letter)</option>
            </select>
        </fieldset>
        
        <div id="container-por-proyecto" class="hidden">
            <fieldset>
                <legend data-translate-key="packageDetails">Detalles del Paquete</legend>
                <label for="nombreClienteProyecto" data-translate-key="clientProjectName">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteProyecto" data-translate-key-placeholder="clientProjectNamePlaceholder1">
                
                <div id="campo-duracion-cursos" class="hidden">
                    <label for="duracionFinalCursos" data-translate-key="packageTotalDuration">Duraci√≥n final total (minutos)</label>
                    <input type="number" id="duracionFinalCursos" min="1" value="10">
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="additionalFeatures">Caracter√≠sticas Adicionales</legend>
                <p style="color:var(--subtle-text); font-size: 0.9rem; margin-top: -1rem; margin-bottom: 1rem;" data-translate-key="additionalFeaturesDesc">Cada opci√≥n seleccionada ajustar√° el precio autom√°ticamente.</p>
                <div class="input-group">
                    <input type="checkbox" id="paquete_graficos">
                    <label for="paquete_graficos" data-translate-key="featureGraphics">Gr√°ficos y T√≠tulos Animados</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_color">
                    <label for="paquete_color" data-translate-key="featureColor">Correcci√≥n de Color Avanzada</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="paquete_musica">
                    <label for="paquete_musica" data-translate-key="featureMusic">B√∫squeda de M√∫sica de Librer√≠a</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="paquete_formatos">
                    <label for="paquete_formatos" data-translate-key="featureFormats">M√∫ltiples Formatos (ej. vertical y horizontal)</label>
                </div>
            </fieldset>
        </div>

        <div id="container-detallado">
            <fieldset>
                <legend data-translate-key="section1Title">üß† 1. Contexto General</legend>
                <label for="nombreClienteDetallado" data-translate-key="clientProjectName">Nombre del Cliente / Proyecto</label>
                <input type="text" id="nombreClienteDetallado" required data-translate-key-placeholder="clientProjectNamePlaceholder2">
                <label for="objetivo" data-translate-key="section1Objective">Objetivo del video y d√≥nde se publicar√°</label>
                <textarea id="objetivo" rows="3" data-translate-key-placeholder="section1ObjectivePlaceholder"></textarea>
            </fieldset>
             <fieldset>
                <legend data-translate-key="section2Title">üì¶ 2. Material a Editar</legend>
                <label for="duracionBruto" data-translate-key="section2RawDuration">Duraci√≥n total aproximada del material en bruto (minutos)</label>
                <input type="number" id="duracionBruto" min="0" value="30" required>
                <label for="organizacionMaterial" data-translate-key="section2Organization">Organizaci√≥n del material</label>
                <select id="organizacionMaterial">
                    <option value="organizado" data-translate-key="section2OrgOrganized">Organizado (pre-seleccionado y clasificado)</option>
                    <option value="desorganizado" selected data-translate-key="section2OrgDisorganized">Desorganizado (hay que seleccionar y limpiar)</option>
                </select>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section3Title">‚úÇÔ∏è 3. Tipo de Edici√≥n</legend>
                <label for="tipoEdicion" data-translate-key="section3Style">Estilo principal de edici√≥n</label>
                <select id="tipoEdicion">
                    <option value="rapida_redes" data-translate-key="section3StyleSocial">R√°pida para Redes (Din√°mica, con zooms, subt√≠tulos virales)</option>
                    <option value="corporativa" selected data-translate-key="section3StyleCorporate">Corporativa / Documental (Clara, profesional, ritmo pausado)</option>
                    <option value="emocional" data-translate-key="section3StyleCinematic">Emocional / Cinematogr√°fica (Correcci√≥n de color avanzada, sound design)</option>
                </select>
                 <div class="input-group">
                    <input type="checkbox" id="multicam">
                    <label for="multicam" data-translate-key="section3Multicam">¬øSe necesita edici√≥n multic√°mara?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="motionGraphics">
                    <label for="motionGraphics" data-translate-key="section3Motion">¬øIncluir√° Motion Graphics / Animaci√≥n (After Effects)?</label>
                </div>
                <div id="campo-complejidad-motion" class="hidden campo-dinamico">
                     <label for="complejidadMotion" data-translate-key="section3MotionComplexity">Complejidad de los Motion Graphics</label>
                     <select id="complejidadMotion">
                         <option value="baja" data-translate-key="section3MotionLow">Baja (T√≠tulos, tercios inferiores animados)</option>
                         <option value="media" data-translate-key="section3MotionMid">Media (Animaci√≥n de logos, transiciones personalizadas)</option>
                         <option value="alta" data-translate-key="section3MotionHigh">Alta (Explicaciones animadas complejas, tracking, VFX)</option>
                     </select>
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section4Title">üî† 4. Elementos Extra</legend>
                <label for="subtitulos" data-translate-key="section4Subtitles">Subt√≠tulos</label>
                <select id="subtitulos">
                    <option value="no" data-translate-key="section4SubtitlesNo">No necesarios</option>
                    <option value="automaticos" data-translate-key="section4SubtitlesAuto">Autom√°ticos (con revisi√≥n)</option>
                    <option value="personalizados" data-translate-key="section4SubtitlesCustom">Personalizados (animados, estilo de marca)</option>
                </select>
                <div class="input-group">
                    <input type="checkbox" id="busquedaMusica">
                    <label for="busquedaMusica" data-translate-key="section4Music">¬øNecesita b√∫squeda y licenciamiento de m√∫sica?</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="voiceOver">
                    <label for="voiceOver" data-translate-key="section4VO">¬øSe necesita grabaci√≥n y edici√≥n de Voice-over?</label>
                </div>
                 <div class="input-group">
                    <input type="checkbox" id="disenoMiniatura">
                    <label for="disenoMiniatura" data-translate-key="section4Thumbnail">¬øNecesita dise√±o de miniatura/car√°tula (Thumbnail)?</label>
                </div>
            </fieldset>
            <fieldset>
                <legend data-translate-key="section5Title">üìè 5. Entregables y Plazos</legend>
                <label for="duracionFinal" data-translate-key="section5Duration">Duraci√≥n final estimada del video principal (minutos)</label>
                <input type="number" id="duracionFinal" min="1" value="2" required>
                <label for="versionesAdicionales" data-translate-key="section5Versions">¬øCu√°ntas versiones adicionales se necesitan?</label>
                <input type="number" id="versionesAdicionales" min="0" value="1" data-translate-key-placeholder="section5VersionsPlaceholder">
                 <label for="plazoEntrega" data-translate-key="section5Deadline">Plazo de entrega</label>
                <select id="plazoEntrega">
                    <option value="normal" data-translate-key="section5DeadlineNormal">Normal (M√°s de 1 semana)</option>
                    <option value="urgente" data-translate-key="section5DeadlineUrgent">Urgente (3-7 d√≠as)</option>
                    <option value="muy_urgente" data-translate-key="section5DeadlineVeryUrgent">Muy Urgente (Menos de 72 horas)</option>
                </select>
                 <label for="rondasRevision" data-translate-key="section5Revisions">Rondas de cambios incluidas</label>
                <input type="number"id="rondasRevision" min="0" value="2">
            </fieldset>
        </div>
        
        <fieldset>
             <legend data-translate-key="finalParameters">üíµ Par√°metros Finales</legend>
             <label for="moneda" data-translate-key="currency">Moneda del Presupuesto</label>
             <input type="text" id="moneda" value="USD" required data-translate-key-placeholder="currencyPlaceholder">
             <div class="input-group">
                <input type="checkbox" id="acuerdoMensual">
                <label for="acuerdoMensual" data-translate-key="monthlyDiscountLabel">Aplicar descuento del 15% por acuerdo de pago mensual (Retainer)</label>
            </div>
        </fieldset>

        <div class="button-group">
            <button type="submit" data-translate-key="calculateButton">Calcular Presupuesto</button>
            <button type="button" id="btnGenerarPDF" disabled data-translate-key="generatePDFButton">Generar PDF Profesional</button>
        </div>
    </form>

    <div id="resultado-container" class="hidden">
        <h2 data-translate-key="resultsTitle">üìä Resumen del Presupuesto</h2>
        <div id="resultado"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- PAR√ÅMETROS GLOBALES Y TRADUCCIONES ---
        const TARIFA_HORA_INTERNA = 40; 
        const DESCUENTO_MENSUAL = 0.15;
        let currentLanguage = 'es';

        const translations = {
            es: {
                pageTitle: "Lupa Editions | Calculadora de Presupuestos",
                mainHeader: "Lupa Editions | Calculadora de Presupuestos",
                subHeader: "Genera presupuestos profesionales y autom√°ticos.",
                calculationModel: "Modelo de C√°lculo",
                selectProjectType: "Selecciona el tipo de proyecto",
                projectTypeDetailed: "Proyecto Detallado (Precio Fijo Autom√°tico)",
                projectTypeReels: "Paquete de Reels / TikToks",
                projectTypeCorporate: "Paquete de Video Corporativo",
                projectTypeCourses: "Paquete de Cursos / Formaciones",
                projectTypeMotion: "Paquete de Motion Graphics / AE",
                projectTypeVSL: "Paquete de VSL (Video Sales Letter)",
                packageDetails: "Detalles del Paquete",
                clientProjectName: "Nombre del Cliente / Proyecto",
                clientProjectNamePlaceholder1: "Ej: Marca Creativa - Campa√±a Reels Q3",
                clientProjectNamePlaceholder2: "Ej: Video Promocional para Web",
                packageTotalDuration: "Duraci√≥n final total (minutos)",
                additionalFeatures: "Caracter√≠sticas Adicionales",
                additionalFeaturesDesc: "Cada opci√≥n seleccionada ajustar√° el precio autom√°ticamente.",
                featureGraphics: "Gr√°ficos y T√≠tulos Animados",
                featureColor: "Correcci√≥n de Color Avanzada",
                featureMusic: "B√∫squeda de M√∫sica de Librer√≠a",
                featureFormats: "M√∫ltiples Formatos (ej. vertical y horizontal)",
                section1Title: "üß† 1. Contexto General",
                section1Objective: "Objetivo del video y d√≥nde se publicar√°",
                section1ObjectivePlaceholder: "Ej: Video promocional para la home de la web y campa√±a de redes sociales (Instagram, YouTube).",
                section2Title: "üì¶ 2. Material a Editar",
                section2RawDuration: "Duraci√≥n total aproximada del material en bruto (minutos)",
                section2Organization: "Organizaci√≥n del material",
                section2OrgOrganized: "Organizado (pre-seleccionado y clasificado)",
                section2OrgDisorganized: "Desorganizado (hay que seleccionar y limpiar)",
                section3Title: "‚úÇÔ∏è 3. Tipo de Edici√≥n",
                section3Style: "Estilo principal de edici√≥n",
                section3StyleSocial: "R√°pida para Redes (Din√°mica, con zooms, subt√≠tulos virales)",
                section3StyleCorporate: "Corporativa / Documental (Clara, profesional, ritmo pausado)",
                section3StyleCinematic: "Emocional / Cinematogr√°fica (Correcci√≥n de color avanzada, sound design)",
                section3Multicam: "¬øSe necesita edici√≥n multic√°mara?",
                section3Motion: "¬øIncluir√° Motion Graphics / Animaci√≥n (After Effects)?",
                section3MotionComplexity: "Complejidad de los Motion Graphics",
                section3MotionLow: "Baja (T√≠tulos, tercios inferiores animados)",
                section3MotionMid: "Media (Animaci√≥n de logos, transiciones personalizadas)",
                section3MotionHigh: "Alta (Explicaciones animadas complejas, tracking, VFX)",
                section4Title: "üî† 4. Elementos Extra",
                section4Subtitles: "Subt√≠tulos",
                section4SubtitlesNo: "No necesarios",
                section4SubtitlesAuto: "Autom√°ticos (con revisi√≥n)",
                section4SubtitlesCustom: "Personalizados (animados, estilo de marca)",
                section4Music: "¬øNecesita b√∫squeda y licenciamiento de m√∫sica?",
                section4VO: "¬øSe necesita grabaci√≥n y edici√≥n de Voice-over?",
                section4Thumbnail: "¬øNecesita dise√±o de miniatura/car√°tula (Thumbnail)?",
                section5Title: "üìè 5. Entregables y Plazos",
                section5Duration: "Duraci√≥n final estimada del video principal (minutos)",
                section5Versions: "¬øCu√°ntas versiones adicionales se necesitan?",
                section5VersionsPlaceholder: "Ej: 1 (para formato vertical)",
                section5Deadline: "Plazo de entrega",
                section5DeadlineNormal: "Normal (M√°s de 1 semana)",
                section5DeadlineUrgent: "Urgente (3-7 d√≠as)",
                section5DeadlineVeryUrgent: "Muy Urgente (Menos de 72 horas)",
                section5Revisions: "Rondas de cambios incluidas",
                finalParameters: "üíµ Par√°metros Finales",
                currency: "Moneda del Presupuesto",
                currencyPlaceholder: "Ej: USD, EUR, ARS",
                monthlyDiscountLabel: "Aplicar descuento del 15% por acuerdo de pago mensual (Retainer)",
                calculateButton: "Calcular Presupuesto",
                generatePDFButton: "Generar PDF Profesional",
                resultsTitle: "üìä Resumen del Presupuesto",
                resultsSubtotal: "Subtotal",
                resultsMonthlyDiscount: "Descuento Mensual (15%)",
                resultsFinalPrice: "Precio Final Estimado",
                resultsBasePrice: "Precio Base",
                resultsAdditionalFeatures: "Caracter√≠sticas Adicionales",
                resultsTimeBreakdown: "Desglose de Tiempo Estimado",
                resultsTotalHours: "Total Horas Estimadas",
                pdfTitle: "PROPUESTA DE EDICI√ìN DE VIDEO",
                pdfDate: "Fecha",
                pdfClient: "Cliente",
                pdfIntro: "Estimado/a {clientName},\n\nGracias por considerar a Lupa Editions para su proyecto de video. Nos complace presentarle la siguiente propuesta detallada, elaborada en base a los requerimientos que nos ha compartido.",
                pdfScope: "Alcance del Proyecto",
                pdfConcept: "Concepto",
                pdfDetail: "Detalle",
                pdfProjectType: "Tipo de Proyecto",
                pdfFeatures: "Caracter√≠sticas Incluidas",
                pdfStdEditing: "Edici√≥n est√°ndar",
                pdfObjective: "Objetivo Principal",
                pdfEditingStyle: "Estilo de Edici√≥n",
                pdfEstDuration: "Duraci√≥n Estimada",
                pdfDeliverables: "Entregables",
                pdfDeliverablesText: "1 video principal + {versions} versi√≥n(es) adicional(es)",
                pdfMotion: "Motion Graphics / AE",
                pdfMotionYes: "S√≠ ({complexity})",
                pdfMotionNo: "No",
                pdfRevisions: "Rondas de Revisi√≥n",
                pdfRevisionsText: "{revisions} incluidas",
                pdfInvestment: "Inversi√≥n del Proyecto",
                pdfSubtotal: "Subtotal:",
                pdfDiscount: "Descuento (Acuerdo Mensual 15%):",
                pdfFinalTotal: "Total Final:",
                pdfTerms: "T√©rminos y Pr√≥ximos Pasos",
                pdfTerm1: "Esta propuesta es v√°lida por 7 d√≠as. Los precios pueden ajustarse pasado este per√≠odo.",
                pdfTerm2: "El precio es final a menos que los requisitos del proyecto cambien significativamente.",
                pdfTerm3: "Forma de pago: 50% por adelantado para iniciar y 50% a la entrega del video final.",
                pdfTerm4: "Rondas de revisi√≥n adicionales o material no contemplado se presupuestar√°n por separado.",
                pdfStep1Title: "1. Aprobaci√≥n",
                pdfStep1Desc: "Confirmar esta propuesta por correo.",
                pdfStep2Title: "2. Pago Inicial",
                pdfStep2Desc: "Realizar el pago del 50% para agendar el proyecto.",
                pdfStep3Title: "3. Kickoff",
                pdfStep3Desc: "Coordinaremos una reuni√≥n inicial para alinear detalles.",
                pdfFooter: "Lupa Editions | Contacto: tuemail@ejemplo.com | www.tupagina.com",
            },
            en: {
                pageTitle: "Lupa Editions | Budget Calculator",
                mainHeader: "Lupa Editions | Budget Calculator",
                subHeader: "Generate professional and automatic quotes.",
                calculationModel: "Calculation Model",
                selectProjectType: "Select the project type",
                projectTypeDetailed: "Detailed Project (Automatic Fixed Price)",
                projectTypeReels: "Reels / TikToks Package",
                projectTypeCorporate: "Corporate Video Package",
                projectTypeCourses: "Courses / Training Package",
                projectTypeMotion: "Motion Graphics / AE Package",
                projectTypeVSL: "VSL (Video Sales Letter) Package",
                packageDetails: "Package Details",
                clientProjectName: "Client / Project Name",
                clientProjectNamePlaceholder1: "Ex: Creative Brand - Q3 Reels Campaign",
                clientProjectNamePlaceholder2: "Ex: Promotional Video for Website",
                packageTotalDuration: "Total final duration (minutes)",
                additionalFeatures: "Additional Features",
                additionalFeaturesDesc: "Each selected option will automatically adjust the price.",
                featureGraphics: "Animated Graphics and Titles",
                featureColor: "Advanced Color Correction",
                featureMusic: "Stock Music Sourcing",
                featureFormats: "Multiple Formats (e.g., vertical & horizontal)",
                section1Title: "üß† 1. General Context",
                section1Objective: "Video's objective and where it will be published",
                section1ObjectivePlaceholder: "Ex: Promotional video for the website homepage and social media campaign (Instagram, YouTube).",
                section2Title: "üì¶ 2. Footage to Edit",
                section2RawDuration: "Approximate total duration of raw footage (minutes)",
                section2Organization: "Footage organization",
                section2OrgOrganized: "Organized (pre-selected and sorted)",
                section2OrgDisorganized: "Disorganized (footage needs to be sorted and selected)",
                section3Title: "‚úÇÔ∏è 3. Editing Type",
                section3Style: "Main editing style",
                section3StyleSocial: "Fast-Paced for Social Media (Dynamic, zooms, viral subtitles)",
                section3StyleCorporate: "Corporate / Documentary (Clean, professional, steady pace)",
                section3StyleCinematic: "Emotional / Cinematic (Advanced color grading, sound design)",
                section3Multicam: "Is multi-camera editing required?",
                section3Motion: "Include Motion Graphics / Animation (After Effects)?",
                section3MotionComplexity: "Motion Graphics Complexity",
                section3MotionLow: "Low (Titles, animated lower thirds)",
                section3MotionMid: "Medium (Logo animation, custom transitions)",
                section3MotionHigh: "High (Complex animated explanations, tracking, VFX)",
                section4Title: "üî† 4. Extra Elements",
                section4Subtitles: "Subtitles",
                section4SubtitlesNo: "Not required",
                section4SubtitlesAuto: "Automatic (with review)",
                section4SubtitlesCustom: "Custom (animated, branded style)",
                section4Music: "Need to source and license music?",
                section4VO: "Need to record and edit a Voice-over?",
                section4Thumbnail: "Need a thumbnail design?",
                section5Title: "üìè 5. Deliverables & Deadlines",
                section5Duration: "Estimated final duration of the main video (minutes)",
                section5Versions: "How many additional versions are needed?",
                section5VersionsPlaceholder: "Ex: 1 (for vertical format)",
                section5Deadline: "Delivery Deadline",
                section5DeadlineNormal: "Normal (More than 1 week)",
                section5DeadlineUrgent: "Urgent (3-7 days)",
                section5DeadlineVeryUrgent: "Very Urgent (Less than 72 hours)",
                section5Revisions: "Rounds of revisions included",
                finalParameters: "üíµ Final Parameters",
                currency: "Budget Currency",
                currencyPlaceholder: "Ex: USD, EUR, GBP",
                monthlyDiscountLabel: "Apply 15% discount for monthly retainer agreement",
                calculateButton: "Calculate Budget",
                generatePDFButton: "Generate Professional PDF",
                resultsTitle: "üìä Budget Summary",
                resultsSubtotal: "Subtotal",
                resultsMonthlyDiscount: "Monthly Discount (15%)",
                resultsFinalPrice: "Estimated Final Price",
                resultsBasePrice: "Base Price",
                resultsAdditionalFeatures: "Additional Features",
                resultsTimeBreakdown: "Estimated Time Breakdown",
                resultsTotalHours: "Total Estimated Hours",
                pdfTitle: "VIDEO EDITING PROPOSAL",
                pdfDate: "Date",
                pdfClient: "Client",
                pdfIntro: "Dear {clientName},\n\nThank you for considering Lupa Editions for your video project. We are pleased to present the following detailed proposal, based on the requirements you have shared with us.",
                pdfScope: "Project Scope",
                pdfConcept: "Concept",
                pdfDetail: "Detail",
                pdfProjectType: "Project Type",
                pdfFeatures: "Features Included",
                pdfStdEditing: "Standard editing",
                pdfObjective: "Main Objective",
                pdfEditingStyle: "Editing Style",
                pdfEstDuration: "Estimated Duration",
                pdfDeliverables: "Deliverables",
                pdfDeliverablesText: "1 main video + {versions} additional version(s)",
                pdfMotion: "Motion Graphics / AE",
                pdfMotionYes: "Yes ({complexity})",
                pdfMotionNo: "No",
                pdfRevisions: "Rounds of Revisions",
                pdfRevisionsText: "{revisions} included",
                pdfInvestment: "Project Investment",
                pdfSubtotal: "Subtotal:",
                pdfDiscount: "Discount (15% Retainer):",
                pdfFinalTotal: "Final Total:",
                pdfTerms: "Terms & Next Steps",
                pdfTerm1: "This proposal is valid for 7 days. Prices may be adjusted after this period.",
                pdfTerm2: "The price is final unless the project requirements change significantly.",
                pdfTerm3: "Payment terms: 50% upfront to start, and 50% upon final delivery.",
                pdfTerm4: "Additional revisions or material not covered will be quoted separately.",
                pdfStep1Title: "1. Approval",
                pdfStep1Desc: "Confirm this proposal via email.",
                pdfStep2Title: "2. Initial Payment",
                pdfStep2Desc: "Make the 50% down payment to schedule the project.",
                pdfStep3Title: "3. Kickoff",
                pdfStep3Desc: "We will coordinate a kickoff meeting to align on details.",
                pdfFooter: "Lupa Editions | Contact: youremail@example.com | www.yourwebsite.com",
            }
        };

        // --- ELEMENTOS DEL DOM ---
        const allElements = {
            form: document.getElementById('presupuestoForm'),
            tipoProyectoSelect: document.getElementById('tipoProyecto'),
            containerDetallado: document.getElementById('container-detallado'),
            containerPorProyecto: document.getElementById('container-por-proyecto'),
            campoDuracionCursos: document.getElementById('campo-duracion-cursos'),
            resultadoContainer: document.getElementById('resultado-container'),
            resultadoDiv: document.getElementById('resultado'),
            btnGenerarPDF: document.getElementById('btnGenerarPDF'),
            motionGraphicsCheckbox: document.getElementById('motionGraphics'),
            campoComplejidadMotion: document.getElementById('campo-complejidad-motion'),
            btnLangEs: document.getElementById('btn-lang-es'),
            btnLangEn: document.getElementById('btn-lang-en'),
        };

        let currentQuoteData = {};
        
        // --- L√ìGICA DE TRADUCCI√ìN ---
        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            allElements.btnLangEs.classList.toggle('active', lang === 'es');
            allElements.btnLangEn.classList.toggle('active', lang === 'en');

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                el.textContent = translations[lang][key];
            });
             document.querySelectorAll('[data-translate-key-placeholder]').forEach(el => {
                const key = el.dataset.translateKeyPlaceholder;
                el.placeholder = translations[lang][key];
            });
        }

        allElements.btnLangEs.addEventListener('click', () => setLanguage('es'));
        allElements.btnLangEn.addEventListener('click', () => setLanguage('en'));

        // --- L√ìGICA DE VISUALIZACI√ìN DEL FORMULARIO ---
        // (Sin cambios)

        // --- L√ìGICA DE C√ÅLCULO DE HORAS ---
        // (Sin cambios)

        // --- L√ìGICA DE C√ÅLCULO (EVENTO SUBMIT) ---
        allElements.form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!allElements.form.checkValidity()) {
                allElements.form.reportValidity();
                return;
            }

            const tipoProyecto = allElements.tipoProyectoSelect.value;
            const moneda = document.getElementById('moneda').value;
            const esAcuerdoMensual = document.getElementById('acuerdoMensual').checked;
            
            let subtotal = 0;
            let resultadoHTML = '';
            const t = translations[currentLanguage];

            // C√ÅLCULO PARA PAQUETES
            if (tipoProyecto !== 'detallado') {
                const proyecto = preciosPorProyecto[tipoProyecto];
                const precioBase = proyecto.min;
                const rangoDePrecio = proyecto.max - proyecto.min;

                const features = {};
                features[t.featureGraphics] = document.getElementById('paquete_graficos').checked;
                features[t.featureColor] = document.getElementById('paquete_color').checked;
                features[t.featureMusic] = document.getElementById('paquete_musica').checked;
                features[t.featureFormats] = document.getElementById('paquete_formatos').checked;

                const featuresSeleccionadas = Object.keys(features).filter(f => features[f]);
                const costoAdicional = (rangoDePrecio / Object.keys(features).length) * featuresSeleccionadas.length;
                subtotal = precioBase + costoAdicional;
                
                if (tipoProyecto === 'cursos') {
                    const duracion = Number(document.getElementById('duracionFinalCursos').value);
                    subtotal *= duracion;
                }
                
                resultadoHTML = `<h3>${t[ 'projectType' + tipoProyecto.charAt(0).toUpperCase() + tipoProyecto.slice(1) ]}</h3>
                    <p><strong>${t.resultsBasePrice}:</strong> ${precioBase.toLocaleString(currentLanguage, { style: 'currency', currency: moneda })}</p>`;
                if (featuresSeleccionadas.length > 0) {
                     resultadoHTML += `<p><strong>${t.resultsAdditionalFeatures}:</strong></p><ul>${featuresSeleccionadas.map(f => `<li>${f}</li>`).join('')}</ul>`;
                }
                
                currentQuoteData = {
                    modelo: 'proyecto',
                    nombreCliente: document.getElementById('nombreClienteProyecto').value,
                    tipoProyectoNombre: t[ 'projectType' + tipoProyecto.charAt(0).toUpperCase() + tipoProyecto.slice(1) ],
                    features: featuresSeleccionadas
                };
            
            // C√ÅLCULO PARA PROYECTO DETALLADO
            } else {
                 const data = {
                    nombreCliente: document.getElementById('nombreClienteDetallado').value,
                    objetivo: document.getElementById('objetivo').value,
                    duracionBruto: Number(document.getElementById('duracionBruto').value),
                    organizacionMaterial: document.getElementById('organizacionMaterial').value,
                    tipoEdicion: document.getElementById('tipoEdicion').value,
                    multicam: document.getElementById('multicam').checked,
                    motionGraphics: document.getElementById('motionGraphics').checked,
                    complejidadMotion: document.getElementById('complejidadMotion').value,
                    subtitulos: document.getElementById('subtitulos').value,
                    busquedaMusica: document.getElementById('busquedaMusica').checked,
                    voiceOver: document.getElementById('voiceOver').checked,
                    disenoMiniatura: document.getElementById('disenoMiniatura').checked,
                    duracionFinal: Number(document.getElementById('duracionFinal').value),
                    versionesAdicionales: Number(document.getElementById('versionesAdicionales').value),
                    plazoEntrega: document.getElementById('plazoEntrega').value,
                    rondasRevision: Number(document.getElementById('rondasRevision').value)
                };

                const calculo = calcularHoras(data);
                subtotal = calculo.total * TARIFA_HORA_INTERNA;
                
                resultadoHTML = `<h3>${t.resultsTimeBreakdown}</h3><ul>`;
                for (const [key, value] of Object.entries(calculo.desglose)) {
                    if(value > 0) resultadoHTML += `<li>${key}: <strong>${value.toFixed(1)} h</strong></li>`;
                }
                resultadoHTML += `</ul><p><strong>${t.resultsTotalHours}:</strong> <strong>${calculo.total.toFixed(1)} h</strong></p>`;
                
                currentQuoteData = { modelo: 'detallado', ...data, ...calculo };
            }

            let descuentoAplicado = 0;
            if (esAcuerdoMensual) {
                descuentoAplicado = subtotal * DESCUENTO_MENSUAL;
            }
            const precioFinal = subtotal - descuentoAplicado;

            resultadoHTML += `<hr><p><strong>${t.resultsSubtotal}:</strong> ${subtotal.toLocaleString(currentLanguage, { style: 'currency', currency: moneda })}</p>`;
            if(descuentoAplicado > 0) {
                resultadoHTML += `<p><strong>${t.resultsMonthlyDiscount}:</strong> <span class="descuento">-${descuentoAplicado.toLocaleString(currentLanguage, { style: 'currency', currency: moneda })}</span></p>`;
            }

            allElements.resultadoDiv.innerHTML = `${resultadoHTML}
                <div id="resultado-total">
                    ${t.resultsFinalPrice}: ${precioFinal.toLocaleString(currentLanguage, { style: 'currency', currency: moneda, minimumFractionDigits: 2 })}
                </div>`;
            
            Object.assign(currentQuoteData, { subtotal, descuentoAplicado, precio: precioFinal, moneda });
            
            allElements.resultadoContainer.classList.remove('hidden');
            allElements.btnGenerarPDF.disabled = false;
            window.scrollTo({ top: allElements.resultadoContainer.offsetTop - 20, behavior: 'smooth' });
        });
        
        // --- GENERACI√ìN DE PDF ---
        allElements.btnGenerarPDF.addEventListener('click', () => {
             if (Object.keys(currentQuoteData).length === 0) return;
             generarPDF(currentQuoteData, currentLanguage);
        });

        function generarPDF(data, lang) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const t = translations[lang];
            const locale = lang === 'es' ? 'es-ES' : 'en-US';

            // CABECERA
            try {
                const imgData = document.getElementById('company-logo').src;
                doc.addImage(imgData, 'JPEG', 15, 12, 35, 0);
            } catch (e) {
                console.error("Could not load image for PDF:", e);
                doc.setFontSize(20); doc.text("Lupa Editions", 15, 20);
            }
            
            doc.setFontSize(12); doc.setFont('helvetica', 'bold');
            doc.text(t.pdfTitle, 200, 15, null, null, 'right');
            doc.setFont('helvetica', 'normal');
            doc.text(`${t.pdfDate}: ${new Date().toLocaleDateString(locale)}`, 200, 21, null, null, 'right');
            doc.text(`${t.pdfClient}: ${data.nombreCliente || 'N/A'}`, 200, 27, null, null, 'right');
            
            // INTRODUCCI√ìN
            let y = 45;
            doc.setFontSize(11);
            const introText = t.pdfIntro.replace('{clientName}', data.nombreCliente || (lang === 'es' ? 'Cliente' : 'Client'));
            const splitIntro = doc.splitTextToSize(introText, 180);
            doc.text(splitIntro, 15, y);
            y += splitIntro.length * 5 + 10;

            // TABLA DE DETALLES
            doc.setFontSize(14); doc.setFont('helvetica', 'bold'); doc.text(t.pdfScope, 15, y);
            y += 7;

            let tableBody = [];
            const head = [[t.pdfConcept, t.pdfDetail]];

            if (data.modelo === 'proyecto') {
                tableBody = [
                    [t.pdfProjectType, data.tipoProyectoNombre],
                    [t.pdfFeatures, data.features.length > 0 ? doc.splitTextToSize(data.features.join(', '), 120) : t.pdfStdEditing],
                ];
            } else {
                 tableBody = [
                    [t.pdfObjective, doc.splitTextToSize(data.objetivo, 120)],
                    [t.pdfEditingStyle, t['section3Style' + data.tipoEdicion.split('_')[1].charAt(0).toUpperCase() + data.tipoEdicion.split('_')[1].slice(1) ] || data.tipoEdicion],
                    [t.pdfEstDuration, `${data.duracionFinal} min.`],
                    [t.pdfDeliverables, t.pdfDeliverablesText.replace('{versions}', data.versionesAdicionales)],
                    [t.pdfMotion, data.motionGraphics ? t.pdfMotionYes.replace('{complexity}', t['section3Motion' + data.complejidadMotion.charAt(0).toUpperCase() + data.complejidadMotion.slice(1)]) : t.pdfMotionNo],
                    [t.pdfRevisions, t.pdfRevisionsText.replace('{revisions}', data.rondasRevision)],
                ];
            }
            doc.autoTable({ head, body: tableBody, startY: y, theme: 'grid', headStyles: { fillColor: [22, 160, 133] } });
            y = doc.autoTable.previous.finalY + 15;

            // SECCI√ìN DE INVERSI√ìN
            doc.setFontSize(14); doc.setFont('helvetica', 'bold'); doc.text(t.pdfInvestment, 15, y);
            y += 7;
            
            doc.autoTable({
                startY: y, theme: 'plain', styles: { fontSize: 11, cellPadding: 2 },
                body: [
                    [t.pdfSubtotal, `${data.subtotal.toLocaleString(locale, { style: 'currency', currency: data.moneda })}`],
                    ...(data.descuentoAplicado > 0 ? [[t.pdfDiscount, `-${data.descuentoAplicado.toLocaleString(locale, { style: 'currency', currency: data.moneda })}`]] : []),
                    [t.pdfFinalTotal, `${data.precio.toLocaleString(locale, { style: 'currency', currency: data.moneda })}`],
                ],
                columnStyles: { 0: { fontStyle: 'normal' }, 1: { fontStyle: 'bold', halign: 'right' } },
                didDrawCell: (hookData) => {
                    if (hookData.row.index === hookData.table.body.length - 1) {
                        doc.setDrawColor(22, 160, 133); doc.setLineWidth(0.5);
                        doc.line(hookData.cell.x, hookData.cell.y + hookData.cell.height + 1, hookData.cell.x + hookData.cell.width, hookData.cell.y + hookData.cell.height + 1);
                    }
                    if (hookData.row.section === 'body' && data.descuentoAplicado > 0 && hookData.row.index === 1) { doc.setTextColor(220, 53, 69); }
                },
                didParseCell: () => { doc.setTextColor(0,0,0); }
            });
            y = doc.autoTable.previous.finalY + 15;
            
            // T√âRMINOS Y PR√ìXIMOS PASOS
            doc.setFontSize(12); doc.setFont('helvetica', 'bold'); doc.text(t.pdfTerms, 15, y);
            y += 6;
            doc.setFontSize(9); doc.setFont('helvetica', 'normal');
            [t.pdfTerm1, t.pdfTerm2, t.pdfTerm3, t.pdfTerm4].forEach(term => { doc.text(`‚Ä¢ ${term}`, 15, y, { maxWidth: 95 }); y += 10; });

            const nextSteps = [
                { title: t.pdfStep1Title, desc: t.pdfStep1Desc },
                { title: t.pdfStep2Title, desc: t.pdfStep2Desc },
                { title: t.pdfStep3Title, desc: t.pdfStep3Desc }
            ];
            let x = 115;
            y = doc.autoTable.previous.finalY + 21;
            nextSteps.forEach(step => {
                doc.setFont('helvetica', 'bold'); doc.text(step.title, x, y);
                doc.setFont('helvetica', 'normal'); doc.text(step.desc, x, y + 4, { maxWidth: 85 });
                y += 12;
            });

            // PIE DE P√ÅGINA
            const pageCount = doc.internal.getNumberOfPages();
            for(let i = 1; i <= pageCount; i++) {
                doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150);
                doc.setLineWidth(0.2); doc.line(15, 285, 195, 285);
                doc.text(t.pdfFooter, 105, 290, null, null, 'center');
            }
            
            const safeFileName = (data.nombreCliente || 'project').replace(/[\s\/]/g, '_');
            doc.save(`Proposal_LupaEditions_${safeFileName}.pdf`);
        }

        // --- FUNCIONES Y EVENTOS INICIALES (NO MODIFICAR) ---
        function calcularHoras(data) {
            const desglose = {};
            let totalHoras = 0;
            let horasClasificacion = data.duracionBruto * 0.15;
            if (data.organizacionMaterial === 'desorganizado') { horasClasificacion *= 1.5; }
            desglose['Clasificaci√≥n de Material'] = horasClasificacion;
            totalHoras += horasClasificacion;

            let horasEdicion = data.duracionFinal * 1.5;
            const multEdicion = { 'rapida_redes': 1.2, 'corporativa': 1.0, 'emocional': 1.6 };
            horasEdicion *= multEdicion[data.tipoEdicion];
            if (data.multicam) { horasEdicion *= 1.4; }
            desglose['Edici√≥n Principal'] = horasEdicion;
            totalHoras += horasEdicion;

            if (data.motionGraphics) {
                const horasPorComplejidad = { 'baja': 2.0, 'media': 5.0, 'alta': 10.0 };
                const horasMotion = horasPorComplejidad[data.complejidadMotion] * (1 + (data.duracionFinal - 1) * 0.2);
                desglose['Motion Graphics (AE)'] = horasMotion;
                totalHoras += horasMotion;
            }

            let horasExtras = 0;
            if (data.subtitulos === 'automaticos') horasExtras += data.duracionFinal * 0.1;
            else if (data.subtitulos === 'personalizados') horasExtras += data.duracionFinal * 0.3;
            if (data.busquedaMusica) horasExtras += 1;
            if (data.voiceOver) horasExtras += 1.5;
            if (data.disenoMiniatura) horasExtras += 1;
            horasExtras += (horasEdicion * 0.25) * data.versionesAdicionales;
            desglose['Post-Producci√≥n y Extras'] = horasExtras;
            totalHoras += horasExtras;
            
            const horasRevision = totalHoras * 0.15 * data.rondasRevision;
            desglose['Revisiones y Comunicaci√≥n'] = horasRevision;
            totalHoras += horasRevision;

            const factoresUrgencia = { 'normal': 1.0, 'urgente': 1.25, 'muy_urgente': 1.5 };
            const urgencyFactor = factoresUrgencia[data.plazoEntrega];
            let urgencyText = "Normal";
            if (urgencyFactor > 1.0) {
                 totalHoras *= urgencyFactor;
                 urgencyText = data.plazoEntrega.replace('_', ' ').charAt(0).toUpperCase() + data.plazoEntrega.replace('_', ' ').slice(1);
            }

            return { total: totalHoras, desglose: desglose, urgencyFactor: urgencyFactor, urgencyText: urgencyText };
        }
        allElements.tipoProyectoSelect.addEventListener('change', (e) => {
            const tipo = e.target.value;
            const esDetallado = tipo === 'detallado';
            allElements.containerDetallado.classList.toggle('hidden', !esDetallado);
            allElements.containerPorProyecto.classList.toggle('hidden', esDetallado);
            allElements.containerDetallado.querySelectorAll('input, select, textarea').forEach(el => { if(el.hasAttribute('required')) el.required = esDetallado; });
            document.getElementById('nombreClienteProyecto').required = !esDetallado;
            document.getElementById('duracionFinalCursos').required = (tipo === 'cursos');
            allElements.campoDuracionCursos.classList.toggle('hidden', tipo !== 'cursos');
        });
        allElements.motionGraphicsCheckbox.addEventListener('change', (e) => {
            allElements.campoComplejidadMotion.classList.toggle('hidden', !e.target.checked);
        });
        
        // Inicializar en espa√±ol
        setLanguage('es');
        allElements.tipoProyectoSelect.dispatchEvent(new Event('change'));
    });
    </script>
</body>
</html>
